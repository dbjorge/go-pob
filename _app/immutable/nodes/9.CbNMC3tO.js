var Rs=Object.defineProperty;var Ls=Object.getPrototypeOf;var js=Reflect.get;var Gt=t=>{throw TypeError(t)};var zs=(t,e,s)=>e in t?Rs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Ut=(t,e,s)=>zs(t,typeof e!="symbol"?e+"":e,s),kt=(t,e,s)=>e.has(t)||Gt("Cannot "+s);var f=(t,e,s)=>(kt(t,e,"read from private field"),s?s.call(t):e.get(t)),_=(t,e,s)=>e.has(t)?Gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),ne=(t,e,s,r)=>(kt(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),U=(t,e,s)=>(kt(t,e,"access private method"),s);var Jt=(t,e,s,r)=>({set _(i){ne(t,e,i,s)},get _(){return f(t,e,r)}}),Vt=(t,e,s)=>js(Ls(t),s,e);import{a as pe,t as Ce,c as Ws}from"../chunks/disclose-version.DA6AmP8y.js";import"../chunks/legacy.QVjyROj1.js";import{Q as Fs,P as ns,V as Hs,s as E,y as xe,g as a,a6 as Ys,h as D,a7 as Bs,a as ye,a8 as Ds,p as Ve,b as is,c as ct,i as ie,I as as,r as ee,j as ft,e as Ke,k as ve,$ as it}from"../chunks/runtime.CgsK0d0J.js";import{b as Mt,i as os}from"../chunks/this.BVAKjuza.js";import{i as Xs}from"../chunks/lifecycle.D1__vD_y.js";import{a as q,p as et,r as ls,d as Gs,s as cs,f as It,c as ut}from"../chunks/props.B6xuKHJ3.js";import{s as fs,o as Us}from"../chunks/overlay.BHcgSIL_.js";import{b as Js,s as jt}from"../chunks/attributes.CNIIExuF.js";import{a as Kt,o as zt}from"../chunks/index-client.BbsF1tYD.js";import{w as dt,g as Pt}from"../chunks/index.Ch4edXz-.js";import{s as Se,l as ze,c as Et}from"../chunks/global.COrLEc2U.js";import{s as qt}from"../chunks/render.zQJwbA7g.js";import{e as Vs,i as Ks}from"../chunks/each.DiTk-BCW.js";function At(t,e,s,r){var i=t.__styles??(t.__styles={});i[e]!==s&&(i[e]=s,s==null?t.style.removeProperty(e):t.style.setProperty(e,s,""))}var he,Ie,Xe,vt,us;const yt=class yt{constructor(e){_(this,vt);_(this,he,new WeakMap);_(this,Ie);_(this,Xe);ne(this,Xe,e)}observe(e,s){var r=f(this,he).get(e)||new Set;return r.add(s),f(this,he).set(e,r),U(this,vt,us).call(this).observe(e,f(this,Xe)),()=>{var i=f(this,he).get(e);i.delete(s),i.size===0&&(f(this,he).delete(e),f(this,Ie).unobserve(e))}}};he=new WeakMap,Ie=new WeakMap,Xe=new WeakMap,vt=new WeakSet,us=function(){return f(this,Ie)??ne(this,Ie,new ResizeObserver(e=>{for(var s of e){yt.entries.set(s.target,s);for(var r of f(this,he).get(s.target)||[])r(s)}}))},Ut(yt,"entries",new WeakMap);let Ct=yt;var qs=new Ct({box:"border-box"});function Zt(t,e,s){var r=qs.observe(t,()=>s(t[e]));Fs(()=>(ns(()=>s(t[e])),r))}function Zs(t,e,s,r,i){var c=()=>{r(s[t])};s.addEventListener(e,c),c(),(s===document.body||s===window||s===document)&&Hs(()=>{s.removeEventListener(e,c)})}function Le(t){E(t,t.v+1)}const Qs=t=>{const e=t*2,s=e>>16&255,r=e>>8&255,i=e&255;return[s,r,i]},$s=([t,e,s])=>{const r=(t<<16|e<<8|s)/2;return r%1?0:r},er=["filter","shadowBlur","globalCompositeOperation","globalAlpha","fillStyle","strokeStyle"],tr=(t,e,{rgbToId:s=$s,idToRgb:r=Qs}={})=>{const i=t.getContext("2d",e),c=new OffscreenCanvas(t.width,t.height),u=c.getContext("2d",{willReadFrequently:!0,alpha:(e==null?void 0:e.alpha)??!0});let o=t.width,d=t.height;return new Proxy(i,{get(p,y){if((t.width!==o||t.height!==d)&&(o=c.width=t.width,d=c.height=t.height),y==="getLayerIdAt")return(x,I)=>{const[g,b,S]=u.getImageData(x,I,1,1).data;return s([g,b,S])};if(y==="setCurrentLayerId")return x=>{const[I,g,b]=r(x),S=`rgb(${I},${g},${b})`;u.fillStyle=S,u.strokeStyle=S};const h=p[y];return typeof h!="function"?h:(...x)=>{let I=y,g=x;return y==="drawImage"&&(I="fillRect",g=x.slice(-4)),u[I](...g),Reflect.apply(h,p,x)}},set(p,y,h){return p[y]=h,er.includes(y)||(u[y]=h),!0}})};var ae,oe,fe,Pe,at;const Wt=class Wt extends Map{constructor(s){super();_(this,Pe);_(this,ae,new Map);_(this,oe,xe(0));_(this,fe,xe(0));if(s){for(var[r,i]of s)super.set(r,i);f(this,fe).v=super.size}}has(s){var r=f(this,ae),i=r.get(s);if(i===void 0){var c=super.get(s);if(c!==void 0)i=xe(0),r.set(s,i);else return a(f(this,oe)),!1}return a(i),!0}forEach(s,r){U(this,Pe,at).call(this),super.forEach(s,r)}get(s){var r=f(this,ae),i=r.get(s);if(i===void 0){var c=super.get(s);if(c!==void 0)i=xe(0),r.set(s,i);else{a(f(this,oe));return}}return a(i),super.get(s)}set(s,r){var h;var i=f(this,ae),c=i.get(s),u=super.get(s),o=super.set(s,r),d=f(this,oe);if(c===void 0)i.set(s,xe(0)),E(f(this,fe),super.size),Le(d);else if(u!==r){Le(c);var p=d.reactions===null?null:new Set(d.reactions),y=p===null||!((h=c.reactions)!=null&&h.every(x=>p.has(x)));y&&Le(d)}return o}delete(s){var r=f(this,ae),i=r.get(s),c=super.delete(s);return i!==void 0&&(r.delete(s),E(f(this,fe),super.size),E(i,-1),Le(f(this,oe))),c}clear(){if(super.size!==0){super.clear();var s=f(this,ae);E(f(this,fe),0);for(var r of s.values())E(r,-1);Le(f(this,oe)),s.clear()}}keys(){return a(f(this,oe)),super.keys()}values(){return U(this,Pe,at).call(this),super.values()}entries(){return U(this,Pe,at).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return a(f(this,fe)),super.size}};ae=new WeakMap,oe=new WeakMap,fe=new WeakMap,Pe=new WeakSet,at=function(){a(f(this,oe));var s=f(this,ae);if(f(this,fe).v!==s.size)for(var r of Vt(Wt.prototype,this,"keys").call(this))s.has(r)||s.set(r,xe(0));for(var[,i]of f(this,ae))a(i)};let Ye=Wt;const sr=t=>{if(window.TouchEvent&&t instanceof TouchEvent){const{left:r,top:i}=t.target.getBoundingClientRect(),{clientX:c,clientY:u}=t.changedTouches[0];return{x:c-r,y:u-i}}const{offsetX:e,offsetY:s}=t;return{x:e,y:s}},Qt=(t,e)=>{var s,r;t instanceof MouseEvent&&((s=t.target)==null||s.dispatchEvent(new PointerEvent(`layer.pointer${e}`,t)),(r=t.target)==null||r.dispatchEvent(new MouseEvent(`layer.mouse${e}`,t)))},rr=["onclick","oncontextmenu","ondblclick","onauxclick","onmousedown","onmouseenter","onmouseleave","onmouseup","onmousemove","onwheel","ontouchstart","ontouchcancel","ontouchend","ontouchmove","onpointerenter","onpointerleave","onpointerdown","onpointerup","onpointermove","onpointercancel","onlayer.mouseenter","onlayer.mouseleave","onlayer.pointerenter","onlayer.pointerleave","onfocus","onblur","onfullscreenchange","onfullscreenerror","onscroll","oncut","oncopy","onpaste","onkeydown","onkeypress","onkeyup","onmouseover","onmouseout","onselect","ondrag","ondragend","ondragenter","ondragstart","ondragleave","ondragover","ondrop","onpointerover","onpointerout","ongotpointercapture","onlostpointercapture"],nr=t=>console.warn("[svelte-canvas] %s",t),ds=Symbol("register"),ir=t=>Ys(ds)(t);var Ee,Ae,Te,mt,gt,Ge,ge,te,Oe,_e,Ue,Je,Me,j,hs,vs,ys,ms,Nt,gs,ps,ws;class ar{constructor(e){_(this,j);_(this,Ee,new Ye);_(this,Ae,new Ye);_(this,Te,new Ye);_(this,mt,1);_(this,gt,Date.now());_(this,Ge,D(0));_(this,ge);_(this,te);_(this,Oe);_(this,_e);_(this,Ue,D(q([])));_(this,Je,0);_(this,Me);ne(this,te,e),Bs(ds,this.register.bind(this))}init(e,s){ne(this,ge,e),U(this,j,ms).call(this,s),ye(()=>U(this,j,Nt).call(this)),ye(()=>U(this,j,ys).call(this)),ye(()=>(a(f(this,Ge)),U(this,j,gs).call(this))),Kt(()=>U(this,j,ws).call(this))}redraw(){Ds(f(this,Ge))}register({setup:e,render:s,...r}){const i=U(this,j,hs).call(this);return e&&f(this,Ee).set(i,e),f(this,Ae).set(i,s),Object.keys(r).length&&(f(this,te).layerEvents?f(this,Te).set(i,r):nr("Canvas must have layerEvents={true} in order to use layer-level event handlers")),Kt(()=>U(this,j,vs).call(this,i)),i}createEventHandlers(){const e=i=>{const c=`on${i.type}`,u=f(this,te).handlers[c];u==null||u(i)},s=i=>{const{pixelRatio:c}=f(this,te),{x:u,y:o}=sr(i);if(["touchstart","pointermove"].includes(i.type)){const y=f(this,ge).getLayerIdAt(u*c,o*c);U(this,j,ps).call(this,y,i)}if(!f(this,Me))return;const d=`on${i.type.replace("layer.","")}`,p=f(this,Me)[d];p==null||p({x:u,y:o,originalEvent:i})},r=i=>{e(i),f(this,te).layerEvents&&s(i)};return rr.reduce((i,c)=>({...i,[c]:r}),{})}}Ee=new WeakMap,Ae=new WeakMap,Te=new WeakMap,mt=new WeakMap,gt=new WeakMap,Ge=new WeakMap,ge=new WeakMap,te=new WeakMap,Oe=new WeakMap,_e=new WeakMap,Ue=new WeakMap,Je=new WeakMap,Me=new WeakMap,j=new WeakSet,hs=function(){return Jt(this,mt)._++},vs=function(e){f(this,Ae).delete(e),f(this,Te).delete(e)},ys=function(){const{onresize:e,width:s,height:r,pixelRatio:i}=f(this,te);e==null||e({width:s,height:r,pixelRatio:i})},ms=function(e){const s=()=>{const r=[...e.children];E(f(this,Ue),q(r.map(i=>+i.dataset.layerId)))};ne(this,_e,new MutationObserver(()=>s())),f(this,_e).observe(e,{childList:!0}),s()},Nt=function(){f(this,te).autoplay?(ns(()=>this.redraw()),ne(this,Oe,requestAnimationFrame(()=>U(this,j,Nt).call(this)))):cancelAnimationFrame(f(this,Oe))},gs=function(){var d,p,y;const e=f(this,ge),{width:s,height:r,pixelRatio:i,autoclear:c}=f(this,te),u=Date.now()-f(this,gt),o={context:e,width:s,height:r,time:u};e.setTransform(i,0,0,i,0,0),c&&e.clearRect(0,0,s,r);for(const[h,x]of f(this,Ee))x(o),f(this,Ee).delete(h);for(const h of a(f(this,Ue)))(p=(d=f(this,ge)).setCurrentLayerId)==null||p.call(d,h),(y=f(this,Ae).get(h))==null||y(o)},ps=function(e,s){f(this,Je)!==e&&(Qt(s,"leave"),ne(this,Je,e),ne(this,Me,f(this,Te).get(e)),Qt(s,"enter"))},ws=function(){var e;typeof window>"u"||((e=f(this,_e))==null||e.disconnect(),cancelAnimationFrame(f(this,Oe)))};/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function or(t,e){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var r,i,c,u,o=[],d=!0,p=!1;try{if(c=(s=s.call(t)).next,e===0){if(Object(s)!==s)return;d=!1}else for(;!(d=(r=c.call(s)).done)&&(o.push(r.value),o.length!==e);d=!0);}catch(y){p=!0,i=y}finally{try{if(!d&&s.return!=null&&(u=s.return(),Object(u)!==u))return}finally{if(p)throw i}}return o}}function $t(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),s.push.apply(s,r)}return s}function K(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?$t(Object(s),!0).forEach(function(r){lr(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$t(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function lr(t,e,s){return e=gr(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function cr(t,e){if(t==null)return{};var s={},r=Object.keys(t),i,c;for(c=0;c<r.length;c++)i=r[c],!(e.indexOf(i)>=0)&&(s[i]=t[i]);return s}function fr(t,e){if(t==null)return{};var s=cr(t,e),r,i;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(i=0;i<c.length;i++)r=c[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function es(t,e){return dr(t)||or(t,e)||bs(t,e)||yr()}function tt(t){return ur(t)||hr(t)||bs(t)||vr()}function ur(t){if(Array.isArray(t))return Rt(t)}function dr(t){if(Array.isArray(t))return t}function hr(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function bs(t,e){if(t){if(typeof t=="string")return Rt(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Rt(t,e)}}function Rt(t,e){(e==null||e>t.length)&&(e=t.length);for(var s=0,r=new Array(e);s<e;s++)r[s]=t[s];return r}function vr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mr(t,e){if(typeof t!="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gr(t){var e=mr(t,"string");return typeof e=="symbol"?e:String(e)}function Be(t){var e=t.sizes.shift(),s=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[s-1,r-1,1,1],c=Date.now(),u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,o,d;u?(o=new OffscreenCanvas(1,1),d=new OffscreenCanvas(s,r)):(o=document.createElement("canvas"),o.width=1,o.height=1,d=document.createElement("canvas"),d.width=s,d.height=r);var p=o.getContext("2d"),y=d.getContext("2d");y&&(y.fillRect.apply(y,i),p.drawImage(d,s-1,r-1,1,1,0,0,1,1));var h=p&&p.getImageData(0,0,1,1).data[3]!==0,x=Date.now()-c;return[o,d].forEach(function(I){I.height=0,I.width=0}),u?(postMessage({width:s,height:r,benchmark:x,isTestPass:h}),!h&&t.sizes.length&&Be(t)):h?t.onSuccess(s,r,x):(t.onError(s,r,x),t.sizes.length&&Be(t)),h}var Tt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},pr=["onError","onSuccess"],ke={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},je={};function Ot(t){var e=t.width===t.height,s=t.height===1,r=t.width===1,i=[];if(!t.width||!t.height)t.sizes.forEach(function(y){var h=e||s?y:1,x=e||r?y:1;i.push([h,x])});else for(var c=t.min||ke.min,u=t.step||ke.step,o=Math.max(t.width,t.height);o>=c;){var d=e||s?o:1,p=e||r?o:1;i.push([d,p]),o-=u}return i}function st(t){var e=window&&"HTMLCanvasElement"in window,s=window&&"OffscreenCanvas"in window,r=Date.now(),i=t.onError,c=t.onSuccess,u=fr(t,pr),o=null;if(!e)return!1;if(t.useWorker&&s){var d=`
            var canvasTest = `.concat(Be.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),p=new Blob([d],{type:"application/javascript"}),y=URL.createObjectURL(p);o=new Worker(y),URL.revokeObjectURL(y),o.onmessage=function(h){var x=h.data,I=x.width,g=x.height,b=x.benchmark,S=x.isTestPass;S?(je[r].onSuccess(I,g,b),delete je[r]):je[r].onError(I,g,b)}}if(t.usePromise)return new Promise(function(h,x){var I=K(K({},t),{},{onError:function(R,N,W){var X;if(t.sizes.length===0)X=!0;else{var se=t.sizes.slice(-1),w=es(se,1),Z=es(w[0],2),T=Z[0],Ne=Z[1];X=R===T&&N===Ne}i(R,N,W),X&&x({width:R,height:N,benchmark:W})},onSuccess:function(R,N,W){c(R,N,W),h({width:R,height:N,benchmark:W})}});if(o){var g=I.onError,b=I.onSuccess;je[r]={onError:g,onSuccess:b},o.postMessage(u)}else Be(I)});if(o)je[r]={onError:i,onSuccess:c},o.postMessage(u);else return Be(t)}var wr={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=Ot({width:e.max,height:e.max,min:e.min,step:e.step,sizes:tt(Tt.area)}),r=K(K(K({},ke),e),{},{sizes:s});return st(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=Ot({width:1,height:e.max,min:e.min,step:e.step,sizes:tt(Tt.height)}),r=K(K(K({},ke),e),{},{sizes:s});return st(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=Ot({width:e.max,height:1,min:e.min,step:e.step,sizes:tt(Tt.width)}),r=K(K(K({},ke),e),{},{sizes:s});return st(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=K(K({},ke),e);return s.sizes=tt(s.sizes),s.width&&s.height&&(s.sizes=[[s.width,s.height]]),st(s)}};const br=(t,e,s,r=.1)=>{if(typeof window>"u")return s;for(;!wr.test({sizes:[[t*s,e*s]]});)s-=r;return s};var xr=Ce("<canvas></canvas> <div><!></div>",1);function Sr(t,e){Ve(e,!0);let s=et(e,"style",3,""),r=et(e,"autoplay",3,!1),i=et(e,"autoclear",3,!0),c=et(e,"layerEvents",3,!1),u=ls(e,["$$slots","$$events","$$legacy","width","height","pixelRatio","class","style","autoplay","autoclear","layerEvents","onresize","contextSettings","children"]),o,d,p,y=D(2),h=D(0),x=D(0);const I=ve(()=>e.width??a(h)),g=ve(()=>e.height??a(x)),b=ve(()=>a(y)&&e.pixelRatio==="auto"?br(a(I),a(g),a(y)):e.pixelRatio&&e.pixelRatio!=="auto"?e.pixelRatio:a(y)),S=new ar({get width(){return a(I)},get height(){return a(g)},get pixelRatio(){return a(b)},get autoplay(){return r()},get autoclear(){return i()},get layerEvents(){return c()},get onresize(){return e.onresize},handlers:u});zt(()=>{c()?d=tr(o,e.contextSettings):d=o.getContext("2d",e.contextSettings),S.init(d,p)});const R=()=>S.redraw();var N=xr(),W=is(N);const X=ve(()=>S.createEventHandlers());let se;Mt(W,T=>o=T,()=>o);var w=ct(W,2);At(w,"display","none");var Z=ie(w);return fs(Z,()=>e.children??as),ee(w),Mt(w,T=>p=T,()=>p),ft(()=>{se=Js(W,se,{class:e.class,width:a(I)*a(b),height:a(g)*a(b),style:s(),...a(X)}),At(W,"width",e.width?`${e.width}px`:"100%"),At(W,"height",e.height?`${e.height}px`:"100%")}),Zs("devicePixelRatio","resize",it,T=>E(y,q(T))),Zt(W,"clientWidth",T=>E(h,T)),Zt(W,"clientHeight",T=>E(x,T)),pe(t,N),Ke({redraw:R,get canvas(){return o},set canvas(T){o=T},get context(){return d},set context(T){d=T}})}var kr=Ce("<div></div>");function Ir(t,e){Ve(e,!0);const s=ls(e,["$$slots","$$events","$$legacy"]),r=ir(s);var i=kr();jt(i,"data-layer-id",r),pe(t,i),Ke()}const xs=dt(void 0),Ss=dt(void 0);let C;const De=new Map,We=new Map,de={},ks=new Set,ot={},ht={},Fe={},He={},M={};let rt=.3835;const ts={Juggernaut:{x:-10400,y:5200},Berserker:{x:-10400,y:3700},Chieftain:{x:-10400,y:2200},Raider:{x:10200,y:5200},Deadeye:{x:10200,y:2200},Pathfinder:{x:10200,y:3700},Occultist:{x:-1500,y:-9850},Elementalist:{x:0,y:-9850},Necromancer:{x:1500,y:-9850},Slayer:{x:1500,y:9800},Gladiator:{x:-1500,y:9800},Champion:{x:0,y:9800},Inquisitor:{x:-10400,y:-2200},Hierophant:{x:-10400,y:-3700},Guardian:{x:-10400,y:-5200},Assassin:{x:10200,y:-5200},Trickster:{x:10200,y:-3700},Saboteur:{x:10200,y:-2200},Ascendant:{x:-7800,y:7200}},me={},Pr=async t=>{var s,r,i,c;if(!Se)return;const e=await Se.GetTree(t);C=JSON.parse(e),console.log("Loaded skill tree",C),C.imageZoomLevels&&(rt=C.imageZoomLevels[C.imageZoomLevels.length-1]),Object.keys(C.groups).forEach(u=>{var p;const o=C.groups[u],d=parseInt(u);De.set(d,o),(p=o.nodes)==null||p.forEach(y=>{const h=C.nodes[y];if(We.set(parseInt(y),h),h.classStartIndex!==void 0){ot[d]=h.classStartIndex;for(const x of[...h.out||[],...h.in||[]]){const I=C.nodes[x];I.skill&&I.ascendancyName===void 0&&(ht[h.classStartIndex]=[...ht[h.classStartIndex]||[],I.skill])}}h.ascendancyName!==void 0&&(de[d]=h.ascendancyName),h.isAscendancyStart&&(ks.add(d),h.ascendancyName&&(me[h.ascendancyName]={x:ts[h.ascendancyName].x-o.x,y:ts[h.ascendancyName].y-o.y}))})});for(const u of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const o=(s=C.sprites[u])==null?void 0:s[rt];Object.keys((o==null?void 0:o.coords)||{}).forEach(d=>o&&(Fe[d]=o))}for(const u of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const o=(r=C.sprites[u])==null?void 0:r[rt];Object.keys(o.coords).forEach(d=>o&&(He[d]=o))}for(const u of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let o=(i=C.sprites[u])==null?void 0:i[rt];o||(o=(c=C.sprites[u])==null?void 0:c[Object.keys(C.sprites[u])[0]]),Object.keys((o==null?void 0:o.coords)||{}).forEach(d=>o&&(M[d]=o))}xs.set(C),Ss.set(t)},lt=(t,e,s,r,i)=>({x:(Math.abs(C.min_x)+t+s)/i,y:(Math.abs(C.min_y)+e+r)/i}),Er=(t,e,s)=>{const r=Math.PI/180*s,i=Math.cos(r),c=Math.sin(r),u=i*(e.x-t.x)+c*(e.y-t.y)+t.x,o=i*(e.y-t.y)-c*(e.x-t.x)+t.y;return{x:u,y:o}},ss=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],rs=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],Lt=(t,e)=>{var r;const s=(r=C.constants.skillsPerOrbit)==null?void 0:r[t];return s==16?ss[ss.length-e]||0:s==40?rs[rs.length-e]||0:360-360/(s||1)*e},nt={},_t=(t,e,s,r)=>{var i,c;if(t.group===void 0||t.orbit===void 0||t.orbitIndex===void 0||t.skill===void 0||!C.groups||!C.constants.orbitRadii)return{x:0,y:0};if(!(t.skill in nt)){const u=C.groups[t.group],o=(t.ascendancyName&&((i=me[t.ascendancyName])==null?void 0:i.x)||0)+u.x,d=(t.ascendancyName&&((c=me[t.ascendancyName])==null?void 0:c.y)||0)+u.y,p=Lt(t.orbit,t.orbitIndex);nt[t.skill]=Er({x:o,y:d},{x:o,y:d-C.constants.orbitRadii[t.orbit]},p)}return lt(nt[t.skill].x,nt[t.skill].y,e,s,r)},Ar=(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));var Tr=Ce('<li role="menuitem" class="svelte-cjl802"> </li>'),Or=Ce('<div class="flex flex-col gap-2"><fieldset class="border border-white bg-neutral-900 p-2 mt-4 min-w-[15vw]"><legend class="container"> </legend> <div class="container"><div class="flex flex-row gap-1"><ol class="options-list svelte-cjl802"></ol></div></div></fieldset> <div class="flex flex-row items-center justify-center"><button class="container">Close</button></div></div>');function _r(t,e){Ve(e,!0);const s=b=>{var R;const S=[];return(R=b.masteryEffects)==null||R.forEach(N=>{S.push({text:N.stats.join(`
`)??"N/A"})}),S};let r=b=>()=>{e.node||(console.warn("Attempted to select an option without underlying node available."),e.onclose()),e.onSelectOption(e.node,b),e.onclose()};const i=b=>r(b);let c=s(e.node);var u=Or(),o=ie(u),d=ie(o),p=ie(d,!0);ee(d);var y=ct(d,2),h=ie(y),x=ie(h);Vs(x,21,()=>c,Ks,(b,S,R)=>{var N=Tr();jt(N,"id",`option_$${R??""}`);var W=ve(()=>i(R));N.__click=function(...w){var Z;(Z=a(W))==null||Z.apply(this,w)};var X=ve(()=>i(R));N.__keydown=function(...w){var Z;(Z=a(X))==null||Z.apply(this,w)};var se=ie(N,!0);ee(N),ft(()=>qt(se,a(S).text)),pe(b,N)}),ee(x),ee(h),ee(y),ee(o);var I=ct(o,2),g=ie(I);g.__click=function(...b){var S;(S=e.onclose)==null||S.apply(this,b)},ee(I),ee(u),ft(()=>qt(p,e.node.name)),pe(t,u),Ke()}Gs(["click","keydown"]);var Mr=Ce("<div><!> <!></div>"),Cr=Ce('<div class="w-full h-full max-w-full max-h-full overflow-hidden"><!></div>');function Nr(t,e){Ve(e,!0);const s=cs(),r=()=>ut(Et,"$currentBuild",s),i=()=>ut(pt,"$hoverPath",s);let c=D(void 0);ye(()=>{var n;(n=r())==null||n.Build.ClassName.then(k=>E(c,q(k))).catch(ze)});let u=D(void 0);ye(()=>{var n;(n=r())==null||n.Build.AscendClassName.then(k=>E(u,q(k))).catch(ze)});let o;ye(()=>{var n,k,L;(L=(k=(n=r())==null?void 0:n.Build)==null?void 0:k.PassiveNodes)==null||L.then(z=>o=z).catch(ze)});let d=n=>{var L;const k=ht[e.skillTree.classes.findIndex(z=>z.name===a(c))];(L=Se)==null||L.CalculateTreePath(e.skillTreeVersion||"3_18",[...k,...o??[]],n).then(z=>{var Y;if(!z)return;const H=k.includes(z[0]);(Y=Se)==null||Y.AllocateNodes(H?z:z.slice(1)),Et.set(r())})},p=(n,k)=>{console.debug(`Selected mastery option ${k} for mastery node ${n.name} - nodeId ${n.skill}`),d(n.skill??-1)};const y=n=>{Us({component:_r,props:{node:n,onSelectOption:p},backdropClose:!0})};let h=n=>{var L;const k=n.skill??-1;if(o!=null&&o.includes(k))(L=Se)==null||L.DeallocateNodes(k),Et.set(r());else{if(n.isMastery){y(n);return}d(k)}};const x="25px Roboto Flex",I="17px Roboto Flex";let g=D(10),b=D(0),S=D(0);const R=2.6;let N=ve(()=>`https://go-pob-data.pages.dev/data/${(e.skillTreeVersion||"3_18").replace("_",".")}`),W=ve(()=>a(N)+"/tree/assets/");const X={},se={},w=(n,k,L,z,H=!1,Y=!1,re=!1)=>{if(!k)return;const Re=z[k];if(!Re)return;const Q=Re.filename;if(!(Q in X)){const m=new URL(Q).pathname,A=m.substring(m.lastIndexOf("/")+1),v=a(W)+A;X[Q]=new Image,X[Q].src=v}const O=Re.coords[k],ue=O.w/a(g)*R,ce=O.h/a(g)*R,be=L.x-ue/2,P=L.y-ce/2;let l=P;if(H&&(l=P-ce/2),Y&&X[Q].complete){const m=Q+":"+k+"--"+(re?"active":"inactive");if(!(m in se)){const A=document.createElement("canvas"),v=A.getContext("2d");A.width=O.w,A.height=O.h,v.save(),v.beginPath(),v.arc(O.w/2,O.h/2,O.w/2,0,Math.PI*2,!0),v.closePath(),v.clip(),re||(v.filter="brightness(50%) opacity(50%)"),v.drawImage(X[Q],O.x,O.y,O.w,O.h,0,0,O.w,O.h),se[m]=A}n.drawImage(se[m],0,0,O.w,O.h,be,l,ue,ce)}else n.drawImage(X[Q],O.x,O.y,O.w,O.h,be,l,ue,ce);H&&(n.save(),n.translate(be,P),n.rotate(Math.PI),n.drawImage(X[Q],O.x,O.y,O.w,O.h,-ue,-(ce/2),ue,-ce),n.restore())},Z=(n,k,L)=>{const z=[];let H="";return n.split(" ").forEach(Y=>{k.measureText(H+Y).width<L?H+=" "+Y:(z.push(H.trim()),H=Y)}),H.length>0&&z.push(H.trim()),z};let T=D(q({x:Number.MIN_VALUE,y:Number.MIN_VALUE})),Ne=D("unset");const pt=dt([]),le=q({}),qe=dt(),Is=({context:n,width:k,height:L})=>{var Q,O,ue,ce,be;const z=window.performance.now();if(!e.skillTree)return;if(n.clearRect(0,0,k,L),n.fillStyle="#080c11",n.fillRect(0,0,k,L),a(c)){const P=e.skillTree.classes.findIndex(l=>l.name===a(c));if(P in e.skillTree.extraImages){const l=e.skillTree.extraImages[P];if(l.image in le||(le[l.image]=new Image,le[l.image].src=a(N)+"/raw/"+l.image),le[l.image].complete){const m=le[l.image].width/a(g)*R*.5,A=le[l.image].height/a(g)*R*.5,v=lt(l.x,l.y,a(b),a(S),a(g));n.drawImage(le[l.image],0,0,le[l.image].width,le[l.image].height,v.x,v.y,m,A)}}}const H={};for(const[P,l]of De){const m=(P in de&&((Q=me[de[P]])==null?void 0:Q.x)||0)+l.x,A=(P in de&&((O=me[de[P]])==null?void 0:O.y)||0)+l.y,v=lt(m,A,a(b),a(S),a(g)),F=Math.max(...l.orbits);P in ot?a(c)===e.skillTree.classes[ot[P]].name?w(n,"center"+e.skillTree.classes[ot[P]].name.toLowerCase(),v,M):w(n,"PSStartNodeBackgroundInactive",v,M,!1,!0):P in de?ks.has(P)&&w(n,"Classes"+de[P],v,M,!1,!0,a(u)===de[P]):F==1?w(n,"PSGroupBackground1",v,M):F==2?w(n,"PSGroupBackground2",v,M):(F==3||l.orbits.length>1)&&w(n,"PSGroupBackground3",v,M,!0)}for(const[P,l]of We)if(!(l.classStartIndex!==void 0||!l.out||l.group===void 0||l.orbit===void 0))for(const m of l.out){const A=parseInt(m);if(!We.has(A))continue;const v=Math.min(A,P),F=Math.max(A,P),B=v+":"+F;if(B in H)continue;H[B]=!0;const J=We.get(A);if(!J||J.isMastery||l.ascendancyName!==J.ascendancyName||J.classStartIndex!==void 0)continue;if(n.beginPath(),l.group!=J.group||l.orbit!=J.orbit){const G=_t(l,a(b),a(S),a(g)),$=_t(J,a(b),a(S),a(g));n.moveTo(G.x,G.y),n.lineTo($.x,$.y)}else{let G=Math.PI/180-Math.PI/180*Lt(l.orbit,l.orbitIndex),$=Math.PI/180-Math.PI/180*Lt(J.orbit,J.orbitIndex);G-=Math.PI/2,$-=Math.PI/2;const $e=Math.abs(Math.max(G,$)-Math.min(G,$)),_s=$e>Math.PI?Math.max(G,$):Math.min(G,$),Ms=$e>Math.PI?Math.min(G,$):Math.max(G,$),St=De.get(l.group);if(St===void 0)continue;const Cs=(l.ascendancyName&&((ue=me[l.ascendancyName])==null?void 0:ue.x)||0)+St.x,Ns=(l.ascendancyName&&((ce=me[l.ascendancyName])==null?void 0:ce.y)||0)+St.y,Xt=lt(Cs,Ns,a(b),a(S),a(g));n.arc(Xt.x,Xt.y,e.skillTree.constants.orbitRadii[l.orbit]/a(g)+1,_s,Ms)}let V=6;o!=null&&o.includes(P)&&(o!=null&&o.includes(A))?(n.strokeStyle="#e9deb6",V=12):i().includes(P)&&i().includes(A)?n.strokeStyle="#c89c01":n.strokeStyle="#524518",n.lineWidth=V/a(g),n.stroke()}let Y;for(const[P,l]of We){const m=_t(l,a(b),a(S),a(g));let A=0;l.classStartIndex!==void 0||l.isAscendancyStart||(l.isKeystone?A=110:l.isNotable||l.isJewelSocket?A=70:l.isMastery?A=85:A=50),Ar(m,a(T))<A/a(g)&&(Y=l);const v=o==null?void 0:o.includes(P),F=i().indexOf(l.skill)>=0||Y===l;l.classStartIndex!==void 0||(l.isAscendancyStart?w(n,"AscendancyMiddle",m,M):l.isKeystone?(w(n,l.icon,m,v?He:Fe),v||F?w(n,"KeystoneFrameAllocated",m,M):w(n,"KeystoneFrameUnallocated",m,M)):l.isNotable?(w(n,l.icon,m,v?He:Fe),l.ascendancyName?v||F?w(n,"AscendancyFrameLargeAllocated",m,M):w(n,"AscendancyFrameLargeNormal",m,M):v||F?w(n,"NotableFrameAllocated",m,M):w(n,"NotableFrameUnallocated",m,M)):l.isJewelSocket?l.expansionJewel?v||F?w(n,"JewelSocketAltActive",m,M):w(n,"JewelSocketAltNormal",m,M):v||F?w(n,"JewelFrameAllocated",m,M):w(n,"JewelFrameUnallocated",m,M):l.isMastery?v||F?w(n,l.activeIcon,m,He):w(n,l.inactiveIcon,m,Fe):(w(n,l.icon,m,v?He:Fe),l.ascendancyName?v||F?w(n,"AscendancyFrameSmallAllocated",m,M):w(n,"AscendancyFrameSmallNormal",m,M):v||F?w(n,"PSSkillFrameActive",m,M):w(n,"PSSkillFrame",m,M)))}if(Pt(qe)!=Y)if(qe.set(Y),Y!==void 0&&a(c)){const P=ht[e.skillTree.classes.findIndex(m=>m.name===a(c))],l=Y.skill;Se.CalculateTreePath(e.skillTreeVersion||"3_18",[...P,...o??[]],l).then(m=>{m&&pt.set(m)}).catch(ze)}else pt.set([]);const re=Pt(qe);if(re){const P=re.name||"N/A",l=(re.stats||[]).map(V=>({text:V,special:!1}));n.font=x;const m=n.measureText(P??""),A=Math.max(m.width+50,600);n.font=I;const v=[],F=30;let B=85;l&&l.length>0?l.forEach(V=>{v.length>0&&(B+=5),V.text.split(`
`).forEach(G=>{v.length>0&&(B+=10),Z(G,n,A-F).forEach($e=>{v.push({text:$e,offset:B,special:V.special}),B+=20})})}):re.isJewelSocket?(v.push({text:"Click to select this socket",offset:B,special:!0}),B+=20):re.isMastery&&(v.push({text:"Available mastery options are:",offset:B,special:!1}),B+=20,(be=re.masteryEffects)==null||be.forEach(V=>{v.length>0&&(B+=10),V.stats.forEach(G=>{G.split(`
`).forEach(()=>{v.length>0&&(B+=10),v.push({text:G??"N/A",offset:B,special:!0}),B+=20})})}));const J=55;n.fillStyle="rgba(75,63,24,0.9)",n.fillRect(a(T).x,a(T).y,A,J),n.fillStyle="#ffffff",n.font=x,n.textAlign="center",n.fillText(P??"",a(T).x+A/2,a(T).y+35),n.fillStyle="rgba(0,0,0,0.8)",n.fillRect(a(T).x,a(T).y+J,A,B-J),n.font=I,n.textAlign="left",v.forEach(V=>{V.special?n.fillStyle="#8cf34c":n.fillStyle="#ffffff",n.fillText(V.text,a(T).x+F/2,a(T).y+V.offset)})}re?E(Ne,"pointer"):E(Ne,"unset"),n.fillStyle="#ffffff",n.textAlign="right",n.font="12px Roboto Mono";const Re=window.performance.now();n.fillText(`${(Re-z).toFixed(1)}ms`,k-5,17)};let Ft=0,Ht=0,Yt=0,Bt=0,wt=!1;const Ps=n=>{wt=!0,Ft=n.offsetX,Ht=n.offsetY,Yt=a(b),Bt=a(S),E(T,q({x:n.offsetX,y:n.offsetY}));const k=Pt(qe);k&&h(k)},Es=n=>{n.type==="pointerup"&&(wt=!1),E(T,q({x:n.offsetX,y:n.offsetY}))},As=n=>{wt&&(E(b,Yt-(Ft-n.offsetX)*a(g)),E(S,Bt-(Ht-n.offsetY)*a(g))),E(T,q({x:n.offsetX,y:n.offsetY}))},Ts=n=>{n.deltaY>0?a(g)<30&&(E(b,a(b)+n.offsetX),E(S,a(S)+n.offsetY)):a(g)>3&&(E(b,a(b)-n.offsetX),E(S,a(S)-n.offsetY)),E(g,q(Math.min(30,Math.max(3,a(g)+n.deltaY/100)))),n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()};let we=D(void 0),bt=D(0),xt=D(0);const Ze=()=>{a(we)&&(E(bt,q(a(we).offsetWidth)),E(xt,q(a(we).offsetHeight)))};let Dt=D(!1);ye(()=>{!a(Dt)&&e.skillTree&&(E(Dt,!0),E(b,e.skillTree.min_x+window.innerWidth/2*a(g)),E(S,e.skillTree.min_y+window.innerHeight/2*a(g))),Ze()}),zt(()=>{new ResizeObserver(Ze).observe(a(we)),Ze()});var Qe=Cr();It("pointerup",it,Es),It("pointermove",it,As),It("resize",it,Ze);var Os=ie(Qe);os(Os,()=>a(bt)&&a(xt),n=>{var k=Mr(),L=ie(k);Sr(L,{get width(){return a(bt)},get height(){return a(xt)},onpointerdown:Ps,onwheel:Ts,children:(H,Y)=>{Ir(H,{render:Is})},$$slots:{default:!0}});var z=ct(L,2);fs(z,()=>e.children??as),ee(k),ft(()=>jt(k,"style",`touch-action: none; cursor: ${a(Ne)??""}`)),pe(n,k)}),ee(Qe),Mt(Qe,n=>E(we,n),()=>a(we)),pe(t,Qe),Ke()}function Vr(t,e){Ve(e,!1);const s=cs(),r=()=>ut(xs,"$skillTree",s),i=()=>ut(Ss,"$skillTreeVersion",s);zt(()=>{(!r()||!i()||De.size===0)&&Pr("3_18").catch(ze)}),Xs();var c=Ws(),u=is(c);os(u,()=>r()&&i()&&De.size>0,o=>{Nr(o,{get skillTree(){return r()},get skillTreeVersion(){return i()}})}),pe(t,c),Ke()}export{Vr as component};
