var Ms=Object.defineProperty;var Os=Object.getPrototypeOf;var Cs=Reflect.get;var Wt=t=>{throw TypeError(t)};var Ns=(t,e,s)=>e in t?Ms(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Ft=(t,e,s)=>Ns(t,typeof e!="symbol"?e+"":e,s),mt=(t,e,s)=>e.has(t)||Wt("Cannot "+s);var u=(t,e,s)=>(mt(t,e,"read from private field"),s?s.call(t):e.get(t)),A=(t,e,s)=>e.has(t)?Wt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),te=(t,e,s,r)=>(mt(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),B=(t,e,s)=>(mt(t,e,"access private method"),s);var Ht=(t,e,s,r)=>({set _(n){te(t,e,n,s)},get _(){return u(t,e,r)}}),Yt=(t,e,s)=>Cs(Os(t),s,e);import{a as je,t as lt,c as _s}from"../chunks/disclose-version.BiKuDWK2.js";import"../chunks/legacy.CY-94a-c.js";import{Q as Rs,P as qt,V as zs,s as S,y as ve,g as a,ar as Ls,h as W,as as js,a as de,at as Ws,p as ct,b as Zt,c as Qt,i as kt,I as $t,r as It,j as es,e as ft,k as pe,$ as Ze}from"../chunks/runtime.BLVj8dz7.js";import{b as Pt,i as ts}from"../chunks/this.Dx7VmjCJ.js";import{i as Fs}from"../chunks/lifecycle.BIiKv-Jy.js";import{a as U,p as Ue,n as ss,s as rs,f as gt,c as tt}from"../chunks/props.BmCjkDKm.js";import{s as ns}from"../chunks/snippet.Dba1K6CO.js";import{b as Hs,s as is}from"../chunks/attributes.DpYvJWZY.js";import{a as Bt,o as Ot}from"../chunks/index-client.CWFbZt41.js";import{w as st,g as vt}from"../chunks/index.Bnwk7SW7.js";import{s as we,l as Ce,c as pt}from"../chunks/global.O_lnPexJ.js";function wt(t,e,s,r){var n=t.__styles??(t.__styles={});n[e]!==s&&(n[e]=s,s==null?t.style.removeProperty(e):t.style.setProperty(e,s,""))}var fe,xe,Fe,nt,as;const it=class it{constructor(e){A(this,nt);A(this,fe,new WeakMap);A(this,xe);A(this,Fe);te(this,Fe,e)}observe(e,s){var r=u(this,fe).get(e)||new Set;return r.add(s),u(this,fe).set(e,r),B(this,nt,as).call(this).observe(e,u(this,Fe)),()=>{var n=u(this,fe).get(e);n.delete(s),n.size===0&&(u(this,fe).delete(e),u(this,xe).unobserve(e))}}};fe=new WeakMap,xe=new WeakMap,Fe=new WeakMap,nt=new WeakSet,as=function(){return u(this,xe)??te(this,xe,new ResizeObserver(e=>{for(var s of e){it.entries.set(s.target,s);for(var r of u(this,fe).get(s.target)||[])r(s)}}))},Ft(it,"entries",new WeakMap);let Et=it;var Ys=new Et({box:"border-box"});function Dt(t,e,s){var r=Ys.observe(t,()=>s(t[e]));Rs(()=>(qt(()=>s(t[e])),r))}function Bs(t,e,s,r,n){var c=()=>{r(s[t])};s.addEventListener(e,c),c(),(s===document.body||s===window||s===document)&&zs(()=>{s.removeEventListener(e,c)})}function Me(t){S(t,t.v+1)}const Ds=t=>{const e=t*2,s=e>>16&255,r=e>>8&255,n=e&255;return[s,r,n]},Xs=([t,e,s])=>{const r=(t<<16|e<<8|s)/2;return r%1?0:r},Gs=["filter","shadowBlur","globalCompositeOperation","globalAlpha","fillStyle","strokeStyle"],Us=(t,e,{rgbToId:s=Xs,idToRgb:r=Ds}={})=>{const n=t.getContext("2d",e),c=new OffscreenCanvas(t.width,t.height),d=c.getContext("2d",{willReadFrequently:!0,alpha:(e==null?void 0:e.alpha)??!0});let o=t.width,h=t.height;return new Proxy(n,{get(w,g){if((t.width!==o||t.height!==h)&&(o=c.width=t.width,h=c.height=t.height),g==="getLayerIdAt")return(y,v)=>{const[C,F,H]=d.getImageData(y,v,1,1).data;return s([C,F,H])};if(g==="setCurrentLayerId")return y=>{const[v,C,F]=r(y),H=`rgb(${v},${C},${F})`;d.fillStyle=H,d.strokeStyle=H};const f=w[g];return typeof f!="function"?f:(...y)=>{let v=g,C=y;return g==="drawImage"&&(v="fillRect",C=y.slice(-4)),d[v](...C),Reflect.apply(f,w,y)}},set(w,g,f){return w[g]=f,Gs.includes(g)||(d[g]=f),!0}})};var se,re,ie,Se,Qe;const Ct=class Ct extends Map{constructor(s){super();A(this,Se);A(this,se,new Map);A(this,re,ve(0));A(this,ie,ve(0));if(s){for(var[r,n]of s)super.set(r,n);u(this,ie).v=super.size}}has(s){var r=u(this,se),n=r.get(s);if(n===void 0){var c=super.get(s);if(c!==void 0)n=ve(0),r.set(s,n);else return a(u(this,re)),!1}return a(n),!0}forEach(s,r){B(this,Se,Qe).call(this),super.forEach(s,r)}get(s){var r=u(this,se),n=r.get(s);if(n===void 0){var c=super.get(s);if(c!==void 0)n=ve(0),r.set(s,n);else{a(u(this,re));return}}return a(n),super.get(s)}set(s,r){var f;var n=u(this,se),c=n.get(s),d=super.get(s),o=super.set(s,r),h=u(this,re);if(c===void 0)n.set(s,ve(0)),S(u(this,ie),super.size),Me(h);else if(d!==r){Me(c);var w=h.reactions===null?null:new Set(h.reactions),g=w===null||!((f=c.reactions)!=null&&f.every(y=>w.has(y)));g&&Me(h)}return o}delete(s){var r=u(this,se),n=r.get(s),c=super.delete(s);return n!==void 0&&(r.delete(s),S(u(this,ie),super.size),S(n,-1),Me(u(this,re))),c}clear(){if(super.size!==0){super.clear();var s=u(this,se);S(u(this,ie),0);for(var r of s.values())S(r,-1);Me(u(this,re)),s.clear()}}keys(){return a(u(this,re)),super.keys()}values(){return B(this,Se,Qe).call(this),super.values()}entries(){return B(this,Se,Qe).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return a(u(this,ie)),super.size}};se=new WeakMap,re=new WeakMap,ie=new WeakMap,Se=new WeakSet,Qe=function(){a(u(this,re));var s=u(this,se);if(u(this,ie).v!==s.size)for(var r of Yt(Ct.prototype,this,"keys").call(this))s.has(r)||s.set(r,ve(0));for(var[,n]of u(this,se))a(n)};let ze=Ct;const Js=t=>{if(window.TouchEvent&&t instanceof TouchEvent){const{left:r,top:n}=t.target.getBoundingClientRect(),{clientX:c,clientY:d}=t.changedTouches[0];return{x:c-r,y:d-n}}const{offsetX:e,offsetY:s}=t;return{x:e,y:s}},Xt=(t,e)=>{var s,r;t instanceof MouseEvent&&((s=t.target)==null||s.dispatchEvent(new PointerEvent(`layer.pointer${e}`,t)),(r=t.target)==null||r.dispatchEvent(new MouseEvent(`layer.mouse${e}`,t)))},Vs=["onclick","oncontextmenu","ondblclick","onauxclick","onmousedown","onmouseenter","onmouseleave","onmouseup","onmousemove","onwheel","ontouchstart","ontouchcancel","ontouchend","ontouchmove","onpointerenter","onpointerleave","onpointerdown","onpointerup","onpointermove","onpointercancel","onlayer.mouseenter","onlayer.mouseleave","onlayer.pointerenter","onlayer.pointerleave","onfocus","onblur","onfullscreenchange","onfullscreenerror","onscroll","oncut","oncopy","onpaste","onkeydown","onkeypress","onkeyup","onmouseover","onmouseout","onselect","ondrag","ondragend","ondragenter","ondragstart","ondragleave","ondragover","ondrop","onpointerover","onpointerout","ongotpointercapture","onlostpointercapture"],Ks=t=>console.warn("[svelte-canvas] %s",t),os=Symbol("register"),qs=t=>Ls(os)(t);var ke,Ie,Pe,at,ot,He,ye,Z,Ee,Te,Ye,Be,Ae,_,ls,cs,fs,us,Tt,ds,hs,ys;class Zs{constructor(e){A(this,_);A(this,ke,new ze);A(this,Ie,new ze);A(this,Pe,new ze);A(this,at,1);A(this,ot,Date.now());A(this,He,W(0));A(this,ye);A(this,Z);A(this,Ee);A(this,Te);A(this,Ye,W(U([])));A(this,Be,0);A(this,Ae);te(this,Z,e),js(os,this.register.bind(this))}init(e,s){te(this,ye,e),B(this,_,us).call(this,s),de(()=>B(this,_,Tt).call(this)),de(()=>B(this,_,fs).call(this)),de(()=>(a(u(this,He)),B(this,_,ds).call(this))),Bt(()=>B(this,_,ys).call(this))}redraw(){Ws(u(this,He))}register({setup:e,render:s,...r}){const n=B(this,_,ls).call(this);return e&&u(this,ke).set(n,e),u(this,Ie).set(n,s),Object.keys(r).length&&(u(this,Z).layerEvents?u(this,Pe).set(n,r):Ks("Canvas must have layerEvents={true} in order to use layer-level event handlers")),Bt(()=>B(this,_,cs).call(this,n)),n}createEventHandlers(){const e=n=>{const c=`on${n.type}`,d=u(this,Z).handlers[c];d==null||d(n)},s=n=>{const{pixelRatio:c}=u(this,Z),{x:d,y:o}=Js(n);if(["touchstart","pointermove"].includes(n.type)){const g=u(this,ye).getLayerIdAt(d*c,o*c);B(this,_,hs).call(this,g,n)}if(!u(this,Ae))return;const h=`on${n.type.replace("layer.","")}`,w=u(this,Ae)[h];w==null||w({x:d,y:o,originalEvent:n})},r=n=>{e(n),u(this,Z).layerEvents&&s(n)};return Vs.reduce((n,c)=>({...n,[c]:r}),{})}}ke=new WeakMap,Ie=new WeakMap,Pe=new WeakMap,at=new WeakMap,ot=new WeakMap,He=new WeakMap,ye=new WeakMap,Z=new WeakMap,Ee=new WeakMap,Te=new WeakMap,Ye=new WeakMap,Be=new WeakMap,Ae=new WeakMap,_=new WeakSet,ls=function(){return Ht(this,at)._++},cs=function(e){u(this,Ie).delete(e),u(this,Pe).delete(e)},fs=function(){const{onresize:e,width:s,height:r,pixelRatio:n}=u(this,Z);e==null||e({width:s,height:r,pixelRatio:n})},us=function(e){const s=()=>{const r=[...e.children];S(u(this,Ye),U(r.map(n=>+n.dataset.layerId)))};te(this,Te,new MutationObserver(()=>s())),u(this,Te).observe(e,{childList:!0}),s()},Tt=function(){u(this,Z).autoplay?(qt(()=>this.redraw()),te(this,Ee,requestAnimationFrame(()=>B(this,_,Tt).call(this)))):cancelAnimationFrame(u(this,Ee))},ds=function(){var h,w,g;const e=u(this,ye),{width:s,height:r,pixelRatio:n,autoclear:c}=u(this,Z),d=Date.now()-u(this,ot),o={context:e,width:s,height:r,time:d};e.setTransform(n,0,0,n,0,0),c&&e.clearRect(0,0,s,r);for(const[f,y]of u(this,ke))y(o),u(this,ke).delete(f);for(const f of a(u(this,Ye)))(w=(h=u(this,ye)).setCurrentLayerId)==null||w.call(h,f),(g=u(this,Ie).get(f))==null||g(o)},hs=function(e,s){u(this,Be)!==e&&(Xt(s,"leave"),te(this,Be,e),te(this,Ae,u(this,Pe).get(e)),Xt(s,"enter"))},ys=function(){var e;typeof window>"u"||((e=u(this,Te))==null||e.disconnect(),cancelAnimationFrame(u(this,Ee)))};/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Qs(t,e){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var r,n,c,d,o=[],h=!0,w=!1;try{if(c=(s=s.call(t)).next,e===0){if(Object(s)!==s)return;h=!1}else for(;!(h=(r=c.call(s)).done)&&(o.push(r.value),o.length!==e);h=!0);}catch(g){w=!0,n=g}finally{try{if(!h&&s.return!=null&&(d=s.return(),Object(d)!==d))return}finally{if(w)throw n}}return o}}function Gt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,r)}return s}function G(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Gt(Object(s),!0).forEach(function(r){$s(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Gt(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function $s(t,e,s){return e=lr(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function er(t,e){if(t==null)return{};var s={},r=Object.keys(t),n,c;for(c=0;c<r.length;c++)n=r[c],!(e.indexOf(n)>=0)&&(s[n]=t[n]);return s}function tr(t,e){if(t==null)return{};var s=er(t,e),r,n;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)r=c[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Ut(t,e){return rr(t)||Qs(t,e)||ms(t,e)||ar()}function Je(t){return sr(t)||nr(t)||ms(t)||ir()}function sr(t){if(Array.isArray(t))return At(t)}function rr(t){if(Array.isArray(t))return t}function nr(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ms(t,e){if(t){if(typeof t=="string")return At(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return At(t,e)}}function At(t,e){(e==null||e>t.length)&&(e=t.length);for(var s=0,r=new Array(e);s<e;s++)r[s]=t[s];return r}function ir(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ar(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function or(t,e){if(typeof t!="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function lr(t){var e=or(t,"string");return typeof e=="symbol"?e:String(e)}function Le(t){var e=t.sizes.shift(),s=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),n=[s-1,r-1,1,1],c=Date.now(),d=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,o,h;d?(o=new OffscreenCanvas(1,1),h=new OffscreenCanvas(s,r)):(o=document.createElement("canvas"),o.width=1,o.height=1,h=document.createElement("canvas"),h.width=s,h.height=r);var w=o.getContext("2d"),g=h.getContext("2d");g&&(g.fillRect.apply(g,n),w.drawImage(h,s-1,r-1,1,1,0,0,1,1));var f=w&&w.getImageData(0,0,1,1).data[3]!==0,y=Date.now()-c;return[o,h].forEach(function(v){v.height=0,v.width=0}),d?(postMessage({width:s,height:r,benchmark:y,isTestPass:f}),!f&&t.sizes.length&&Le(t)):f?t.onSuccess(s,r,y):(t.onError(s,r,y),t.sizes.length&&Le(t)),f}var bt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},cr=["onError","onSuccess"],be={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Oe={};function xt(t){var e=t.width===t.height,s=t.height===1,r=t.width===1,n=[];if(!t.width||!t.height)t.sizes.forEach(function(g){var f=e||s?g:1,y=e||r?g:1;n.push([f,y])});else for(var c=t.min||be.min,d=t.step||be.step,o=Math.max(t.width,t.height);o>=c;){var h=e||s?o:1,w=e||r?o:1;n.push([h,w]),o-=d}return n}function Ve(t){var e=window&&"HTMLCanvasElement"in window,s=window&&"OffscreenCanvas"in window,r=Date.now(),n=t.onError,c=t.onSuccess,d=tr(t,cr),o=null;if(!e)return!1;if(t.useWorker&&s){var h=`
            var canvasTest = `.concat(Le.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),w=new Blob([h],{type:"application/javascript"}),g=URL.createObjectURL(w);o=new Worker(g),URL.revokeObjectURL(g),o.onmessage=function(f){var y=f.data,v=y.width,C=y.height,F=y.benchmark,H=y.isTestPass;H?(Oe[r].onSuccess(v,C,F),delete Oe[r]):Oe[r].onError(v,C,F)}}if(t.usePromise)return new Promise(function(f,y){var v=G(G({},t),{},{onError:function(L,D,m){var ue;if(t.sizes.length===0)ue=!0;else{var R=t.sizes.slice(-1),Q=Ut(R,1),ae=Ut(Q[0],2),T=ae[0],me=ae[1];ue=L===T&&D===me}n(L,D,m),ue&&y({width:L,height:D,benchmark:m})},onSuccess:function(L,D,m){c(L,D,m),f({width:L,height:D,benchmark:m})}});if(o){var C=v.onError,F=v.onSuccess;Oe[r]={onError:C,onSuccess:F},o.postMessage(d)}else Le(v)});if(o)Oe[r]={onError:n,onSuccess:c},o.postMessage(d);else return Le(t)}var fr={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=xt({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Je(bt.area)}),r=G(G(G({},be),e),{},{sizes:s});return Ve(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=xt({width:1,height:e.max,min:e.min,step:e.step,sizes:Je(bt.height)}),r=G(G(G({},be),e),{},{sizes:s});return Ve(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=xt({width:e.max,height:1,min:e.min,step:e.step,sizes:Je(bt.width)}),r=G(G(G({},be),e),{},{sizes:s});return Ve(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=G(G({},be),e);return s.sizes=Je(s.sizes),s.width&&s.height&&(s.sizes=[[s.width,s.height]]),Ve(s)}};const ur=(t,e,s,r=.1)=>{if(typeof window>"u")return s;for(;!fr.test({sizes:[[t*s,e*s]]});)s-=r;return s};var dr=lt("<canvas></canvas> <div><!></div>",1);function hr(t,e){ct(e,!0);let s=Ue(e,"style",3,""),r=Ue(e,"autoplay",3,!1),n=Ue(e,"autoclear",3,!0),c=Ue(e,"layerEvents",3,!1),d=ss(e,["$$slots","$$events","$$legacy","width","height","pixelRatio","class","style","autoplay","autoclear","layerEvents","onresize","contextSettings","children"]),o,h,w,g=W(2),f=W(0),y=W(0);const v=pe(()=>e.width??a(f)),C=pe(()=>e.height??a(y)),F=pe(()=>a(g)&&e.pixelRatio==="auto"?ur(a(v),a(C),a(g)):e.pixelRatio&&e.pixelRatio!=="auto"?e.pixelRatio:a(g)),H=new Zs({get width(){return a(v)},get height(){return a(C)},get pixelRatio(){return a(F)},get autoplay(){return r()},get autoclear(){return n()},get layerEvents(){return c()},get onresize(){return e.onresize},handlers:d});Ot(()=>{c()?h=Us(o,e.contextSettings):h=o.getContext("2d",e.contextSettings),H.init(h,w)});const L=()=>H.redraw();var D=dr(),m=Zt(D);const ue=pe(()=>H.createEventHandlers());let R;Pt(m,T=>o=T,()=>o);var Q=Qt(m,2);wt(Q,"display","none");var ae=kt(Q);return ns(ae,()=>e.children??$t),It(Q),Pt(Q,T=>w=T,()=>w),es(()=>{R=Hs(m,R,{class:e.class,width:a(v)*a(F),height:a(C)*a(F),style:s(),...a(ue)}),wt(m,"width",e.width?`${e.width}px`:"100%"),wt(m,"height",e.height?`${e.height}px`:"100%")}),Bs("devicePixelRatio","resize",Ze,T=>S(g,U(T))),Dt(m,"clientWidth",T=>S(f,T)),Dt(m,"clientHeight",T=>S(y,T)),je(t,D),ft({redraw:L,get canvas(){return o},set canvas(T){o=T},get context(){return h},set context(T){h=T}})}var yr=lt("<div></div>");function mr(t,e){ct(e,!0);const s=ss(e,["$$slots","$$events","$$legacy"]),r=qs(s);var n=yr();is(n,"data-layer-id",r),je(t,n),ft()}const gs=st(void 0),vs=st(void 0);let O;const We=new Map,Ne=new Map,ce={},ps=new Set,$e={},rt={},_e={},Re={},M={};let Ke=.3835;const Jt={Juggernaut:{x:-10400,y:5200},Berserker:{x:-10400,y:3700},Chieftain:{x:-10400,y:2200},Raider:{x:10200,y:5200},Deadeye:{x:10200,y:2200},Pathfinder:{x:10200,y:3700},Occultist:{x:-1500,y:-9850},Elementalist:{x:0,y:-9850},Necromancer:{x:1500,y:-9850},Slayer:{x:1500,y:9800},Gladiator:{x:-1500,y:9800},Champion:{x:0,y:9800},Inquisitor:{x:-10400,y:-2200},Hierophant:{x:-10400,y:-3700},Guardian:{x:-10400,y:-5200},Assassin:{x:10200,y:-5200},Trickster:{x:10200,y:-3700},Saboteur:{x:10200,y:-2200},Ascendant:{x:-7800,y:7200}},he={},gr=async t=>{var s,r,n,c;if(!we)return;const e=await we.GetTree(t);O=JSON.parse(e),console.log("Loaded skill tree",O),O.imageZoomLevels&&(Ke=O.imageZoomLevels[O.imageZoomLevels.length-1]),Object.keys(O.groups).forEach(d=>{var w;const o=O.groups[d],h=parseInt(d);We.set(h,o),(w=o.nodes)==null||w.forEach(g=>{const f=O.nodes[g];if(Ne.set(parseInt(g),f),f.classStartIndex!==void 0){$e[h]=f.classStartIndex;for(const y of[...f.out||[],...f.in||[]]){const v=O.nodes[y];v.skill&&v.ascendancyName===void 0&&(rt[f.classStartIndex]=[...rt[f.classStartIndex]||[],v.skill])}}f.ascendancyName!==void 0&&(ce[h]=f.ascendancyName),f.isAscendancyStart&&(ps.add(h),f.ascendancyName&&(he[f.ascendancyName]={x:Jt[f.ascendancyName].x-o.x,y:Jt[f.ascendancyName].y-o.y}))})});for(const d of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const o=(s=O.sprites[d])==null?void 0:s[Ke];Object.keys((o==null?void 0:o.coords)||{}).forEach(h=>o&&(_e[h]=o))}for(const d of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const o=(r=O.sprites[d])==null?void 0:r[Ke];Object.keys(o.coords).forEach(h=>o&&(Re[h]=o))}for(const d of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let o=(n=O.sprites[d])==null?void 0:n[Ke];o||(o=(c=O.sprites[d])==null?void 0:c[Object.keys(O.sprites[d])[0]]),Object.keys((o==null?void 0:o.coords)||{}).forEach(h=>o&&(M[h]=o))}gs.set(O),vs.set(t)},et=(t,e,s,r,n)=>({x:(Math.abs(O.min_x)+t+s)/n,y:(Math.abs(O.min_y)+e+r)/n}),vr=(t,e,s)=>{const r=Math.PI/180*s,n=Math.cos(r),c=Math.sin(r),d=n*(e.x-t.x)+c*(e.y-t.y)+t.x,o=n*(e.y-t.y)-c*(e.x-t.x)+t.y;return{x:d,y:o}},Vt=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],Kt=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],Mt=(t,e)=>{var r;const s=(r=O.constants.skillsPerOrbit)==null?void 0:r[t];return s==16?Vt[Vt.length-e]||0:s==40?Kt[Kt.length-e]||0:360-360/(s||1)*e},qe={},St=(t,e,s,r)=>{var n,c;if(t.group===void 0||t.orbit===void 0||t.orbitIndex===void 0||t.skill===void 0||!O.groups||!O.constants.orbitRadii)return{x:0,y:0};if(!(t.skill in qe)){const d=O.groups[t.group],o=(t.ascendancyName&&((n=he[t.ascendancyName])==null?void 0:n.x)||0)+d.x,h=(t.ascendancyName&&((c=he[t.ascendancyName])==null?void 0:c.y)||0)+d.y,w=Mt(t.orbit,t.orbitIndex);qe[t.skill]=vr({x:o,y:h},{x:o,y:h-O.constants.orbitRadii[t.orbit]},w)}return et(qe[t.skill].x,qe[t.skill].y,e,s,r)},pr=(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));var wr=lt("<div><!> <!></div>"),br=lt('<div class="w-full h-full max-w-full max-h-full overflow-hidden"><!></div>');function xr(t,e){ct(e,!0);const s=rs(),r=()=>tt(pt,"$currentBuild",s),n=()=>tt(ae,"$hoverPath",s);let c=W(void 0);de(()=>{var i;(i=r())==null||i.Build.ClassName.then(k=>S(c,U(k))).catch(Ce)});let d=W(void 0);de(()=>{var i;(i=r())==null||i.Build.AscendClassName.then(k=>S(d,U(k))).catch(Ce)});let o;de(()=>{var i,k,j;(j=(k=(i=r())==null?void 0:i.Build)==null?void 0:k.PassiveNodes)==null||j.then(Y=>o=Y).catch(Ce)});let h=i=>{var j,Y;const k=i.skill??-1;if(o!=null&&o.includes(k))(j=we)==null||j.DeallocateNodes(k),pt.set(r());else{const z=rt[e.skillTree.classes.findIndex(N=>N.name===a(c))];(Y=we)==null||Y.CalculateTreePath(e.skillTreeVersion||"3_18",[...z,...o??[]],k).then(N=>{var oe;if(!N)return;const $=z.includes(N[0]);(oe=we)==null||oe.AllocateNodes($?N:N.slice(1)),pt.set(r())})}};const w="25px Roboto Flex",g="17px Roboto Flex";let f=W(10),y=W(0),v=W(0);const C=2.6;let F=pe(()=>`https://go-pob-data.pages.dev/data/${(e.skillTreeVersion||"3_18").replace("_",".")}`),H=pe(()=>a(F)+"/tree/assets/");const L={},D={},m=(i,k,j,Y,z=!1,N=!1,$=!1)=>{if(!k)return;const oe=Y[k];if(!oe)return;const J=oe.filename;if(!(J in L)){const I=new URL(J).pathname,b=I.substring(I.lastIndexOf("/")+1),P=a(H)+b;L[J]=new Image,L[J].src=P}const E=oe.coords[k],le=E.w/a(f)*C,ne=E.h/a(f)*C,x=j.x-le/2,l=j.y-ne/2;let p=l;if(z&&(p=l-ne/2),N&&L[J].complete){const I=J+":"+k+"--"+($?"active":"inactive");if(!(I in D)){const b=document.createElement("canvas"),P=b.getContext("2d");b.width=E.w,b.height=E.h,P.save(),P.beginPath(),P.arc(E.w/2,E.h/2,E.w/2,0,Math.PI*2,!0),P.closePath(),P.clip(),$||(P.filter="brightness(50%) opacity(50%)"),P.drawImage(L[J],E.x,E.y,E.w,E.h,0,0,E.w,E.h),D[I]=b}i.drawImage(D[I],0,0,E.w,E.h,x,p,le,ne)}else i.drawImage(L[J],E.x,E.y,E.w,E.h,x,p,le,ne);z&&(i.save(),i.translate(x,l),i.rotate(Math.PI),i.drawImage(L[J],E.x,E.y,E.w,E.h,-le,-(ne/2),le,-ne),i.restore())},ue=(i,k,j)=>{const Y=[];let z="";return i.split(" ").forEach(N=>{k.measureText(z+N).width<j?z+=" "+N:(Y.push(z.trim()),z=N)}),z.length>0&&Y.push(z.trim()),Y};let R=W(U({x:Number.MIN_VALUE,y:Number.MIN_VALUE})),Q=W("unset");const ae=st([]),T=U({}),me=st(),ws=({context:i,width:k,height:j})=>{var J,E,le,ne;const Y=window.performance.now();if(!e.skillTree)return;if(i.clearRect(0,0,k,j),i.fillStyle="#080c11",i.fillRect(0,0,k,j),a(c)){const x=e.skillTree.classes.findIndex(l=>l.name===a(c));if(x in e.skillTree.extraImages){const l=e.skillTree.extraImages[x];if(l.image in T||(T[l.image]=new Image,T[l.image].src=a(F)+"/raw/"+l.image),T[l.image].complete){const p=T[l.image].width/a(f)*C*.5,I=T[l.image].height/a(f)*C*.5,b=et(l.x,l.y,a(y),a(v),a(f));i.drawImage(T[l.image],0,0,T[l.image].width,T[l.image].height,b.x,b.y,p,I)}}}const z={};for(const[x,l]of We){const p=(x in ce&&((J=he[ce[x]])==null?void 0:J.x)||0)+l.x,I=(x in ce&&((E=he[ce[x]])==null?void 0:E.y)||0)+l.y,b=et(p,I,a(y),a(v),a(f)),P=Math.max(...l.orbits);x in $e?a(c)===e.skillTree.classes[$e[x]].name?m(i,"center"+e.skillTree.classes[$e[x]].name.toLowerCase(),b,M):m(i,"PSStartNodeBackgroundInactive",b,M,!1,!0):x in ce?ps.has(x)&&m(i,"Classes"+ce[x],b,M,!1,!0,a(d)===ce[x]):P==1?m(i,"PSGroupBackground1",b,M):P==2?m(i,"PSGroupBackground2",b,M):(P==3||l.orbits.length>1)&&m(i,"PSGroupBackground3",b,M,!0)}for(const[x,l]of Ne)if(!(l.classStartIndex!==void 0||!l.out||l.group===void 0||l.orbit===void 0))for(const p of l.out){const I=parseInt(p);if(!Ne.has(I))continue;const b=Math.min(I,x),P=Math.max(I,x),ee=b+":"+P;if(ee in z)continue;z[ee]=!0;const X=Ne.get(I);if(!X||X.isMastery||l.ascendancyName!==X.ascendancyName||X.classStartIndex!==void 0)continue;if(i.beginPath(),l.group!=X.group||l.orbit!=X.orbit){const V=St(l,a(y),a(v),a(f)),q=St(X,a(y),a(v),a(f));i.moveTo(V.x,V.y),i.lineTo(q.x,q.y)}else{let V=Math.PI/180-Math.PI/180*Mt(l.orbit,l.orbitIndex),q=Math.PI/180-Math.PI/180*Mt(X.orbit,X.orbitIndex);V-=Math.PI/2,q-=Math.PI/2;const Ge=Math.abs(Math.max(V,q)-Math.min(V,q)),Ps=Ge>Math.PI?Math.max(V,q):Math.min(V,q),Es=Ge>Math.PI?Math.min(V,q):Math.max(V,q),yt=We.get(l.group);if(yt===void 0)continue;const Ts=(l.ascendancyName&&((le=he[l.ascendancyName])==null?void 0:le.x)||0)+yt.x,As=(l.ascendancyName&&((ne=he[l.ascendancyName])==null?void 0:ne.y)||0)+yt.y,jt=et(Ts,As,a(y),a(v),a(f));i.arc(jt.x,jt.y,e.skillTree.constants.orbitRadii[l.orbit]/a(f)+1,Ps,Es)}let K=6;o!=null&&o.includes(x)&&(o!=null&&o.includes(I))?(i.strokeStyle="#e9deb6",K=12):n().includes(x)&&n().includes(I)?i.strokeStyle="#c89c01":i.strokeStyle="#524518",i.lineWidth=K/a(f),i.stroke()}let N;for(const[x,l]of Ne){const p=St(l,a(y),a(v),a(f));let I=0;l.classStartIndex!==void 0||l.isAscendancyStart||(l.isKeystone?I=110:l.isNotable||l.isJewelSocket?I=70:l.isMastery?I=85:I=50),pr(p,a(R))<I/a(f)&&(N=l);const b=o==null?void 0:o.includes(x),P=n().indexOf(l.skill)>=0||N===l;l.classStartIndex!==void 0||(l.isAscendancyStart?m(i,"AscendancyMiddle",p,M):l.isKeystone?(m(i,l.icon,p,b?Re:_e),b||P?m(i,"KeystoneFrameAllocated",p,M):m(i,"KeystoneFrameUnallocated",p,M)):l.isNotable?(m(i,l.icon,p,b?Re:_e),l.ascendancyName?b||P?m(i,"AscendancyFrameLargeAllocated",p,M):m(i,"AscendancyFrameLargeNormal",p,M):b||P?m(i,"NotableFrameAllocated",p,M):m(i,"NotableFrameUnallocated",p,M)):l.isJewelSocket?l.expansionJewel?b||P?m(i,"JewelSocketAltActive",p,M):m(i,"JewelSocketAltNormal",p,M):b||P?m(i,"JewelFrameAllocated",p,M):m(i,"JewelFrameUnallocated",p,M):l.isMastery?b||P?m(i,l.activeIcon,p,Re):m(i,l.inactiveIcon,p,_e):(m(i,l.icon,p,b?Re:_e),l.ascendancyName?b||P?m(i,"AscendancyFrameSmallAllocated",p,M):m(i,"AscendancyFrameSmallNormal",p,M):b||P?m(i,"PSSkillFrameActive",p,M):m(i,"PSSkillFrame",p,M)))}if(vt(me)!=N)if(me.set(N),N!==void 0&&a(c)){const x=rt[e.skillTree.classes.findIndex(p=>p.name===a(c))],l=N.skill;we.CalculateTreePath(e.skillTreeVersion||"3_18",[...x,...o??[]],l).then(p=>{p&&ae.set(p)}).catch(Ce)}else ae.set([]);const $=vt(me);if($){const x=$.name||"N/A",l=($.stats||[]).map(K=>({text:K,special:!1}));i.font=w;const p=i.measureText(x??""),I=Math.max(p.width+50,600);i.font=g;const b=[],P=30;let ee=85;l&&l.length>0?l.forEach(K=>{b.length>0&&(ee+=5),K.text.split(`
`).forEach(V=>{b.length>0&&(ee+=10),ue(V,i,I-P).forEach(Ge=>{b.push({text:Ge,offset:ee,special:K.special}),ee+=20})})}):$.isJewelSocket&&(b.push({text:"Click to select this socket",offset:ee,special:!0}),ee+=20);const X=55;i.fillStyle="rgba(75,63,24,0.9)",i.fillRect(a(R).x,a(R).y,I,X),i.fillStyle="#ffffff",i.font=w,i.textAlign="center",i.fillText(x??"",a(R).x+I/2,a(R).y+35),i.fillStyle="rgba(0,0,0,0.8)",i.fillRect(a(R).x,a(R).y+X,I,ee-X),i.font=g,i.textAlign="left",b.forEach(K=>{K.special?i.fillStyle="#8cf34c":i.fillStyle="#ffffff",i.fillText(K.text,a(R).x+P/2,a(R).y+K.offset)})}$?S(Q,"pointer"):S(Q,"unset"),i.fillStyle="#ffffff",i.textAlign="right",i.font="12px Roboto Mono";const oe=window.performance.now();i.fillText(`${(oe-Y).toFixed(1)}ms`,k-5,17)};let Nt=0,_t=0,Rt=0,zt=0,ut=!1;const bs=i=>{ut=!0,Nt=i.offsetX,_t=i.offsetY,Rt=a(y),zt=a(v),S(R,U({x:i.offsetX,y:i.offsetY}));const k=vt(me);k&&h(k)},xs=i=>{i.type==="pointerup"&&(ut=!1),S(R,U({x:i.offsetX,y:i.offsetY}))},Ss=i=>{ut&&(S(y,Rt-(Nt-i.offsetX)*a(f)),S(v,zt-(_t-i.offsetY)*a(f))),S(R,U({x:i.offsetX,y:i.offsetY}))},ks=i=>{i.deltaY>0?a(f)<30&&(S(y,a(y)+i.offsetX),S(v,a(v)+i.offsetY)):a(f)>3&&(S(y,a(y)-i.offsetX),S(v,a(v)-i.offsetY)),S(f,U(Math.min(30,Math.max(3,a(f)+i.deltaY/100)))),i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation()};let ge=W(void 0),dt=W(0),ht=W(0);const De=()=>{a(ge)&&(S(dt,U(a(ge).offsetWidth)),S(ht,U(a(ge).offsetHeight)))};let Lt=W(!1);de(()=>{!a(Lt)&&e.skillTree&&(S(Lt,!0),S(y,e.skillTree.min_x+window.innerWidth/2*a(f)),S(v,e.skillTree.min_y+window.innerHeight/2*a(f))),De()}),Ot(()=>{new ResizeObserver(De).observe(a(ge)),De()});var Xe=br();gt("pointerup",Ze,xs),gt("pointermove",Ze,Ss),gt("resize",Ze,De);var Is=kt(Xe);ts(Is,()=>a(dt)&&a(ht),i=>{var k=wr(),j=kt(k);hr(j,{get width(){return a(dt)},get height(){return a(ht)},onpointerdown:bs,onwheel:ks,children:(z,N)=>{mr(z,{render:ws})},$$slots:{default:!0}});var Y=Qt(j,2);ns(Y,()=>e.children??$t),It(k),es(()=>is(k,"style",`touch-action: none; cursor: ${a(Q)??""}`)),je(i,k)}),It(Xe),Pt(Xe,i=>S(ge,i),()=>a(ge)),je(t,Xe),ft()}function Rr(t,e){ct(e,!1);const s=rs(),r=()=>tt(gs,"$skillTree",s),n=()=>tt(vs,"$skillTreeVersion",s);Ot(()=>{(!r()||!n()||We.size===0)&&gr("3_18").catch(Ce)}),Fs();var c=_s(),d=Zt(c);ts(d,()=>r()&&n()&&We.size>0,o=>{xr(o,{get skillTree(){return r()},get skillTreeVersion(){return n()}})}),je(t,c),ft()}export{Rr as component};
