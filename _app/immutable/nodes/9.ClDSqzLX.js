var Ns=Object.defineProperty;var _s=Object.getPrototypeOf;var Rs=Reflect.get;var Ht=e=>{throw TypeError(e)};var js=(e,t,s)=>t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Yt=(e,t,s)=>js(e,typeof t!="symbol"?t+"":t,s),ft=(e,t,s)=>t.has(e)||Ht("Cannot "+s);var f=(e,t,s)=>(ft(e,t,"read from private field"),s?s.call(e):t.get(e)),E=(e,t,s)=>t.has(e)?Ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),$=(e,t,s,r)=>(ft(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),Y=(e,t,s)=>(ft(e,t,"access private method"),s);var Bt=(e,t,s,r)=>({set _(n){$(e,t,n,s)},get _(){return f(e,t,r)}}),Gt=(e,t,s)=>Rs(_s(e),s,t);import{a as je,t as rt,c as Ls}from"../chunks/disclose-version.BiKuDWK2.js";import"../chunks/legacy.CY-94a-c.js";import{Q as zs,P as Qt,V as Ws,s as x,y as ye,g as i,ar as Fs,h as F,as as Ds,a as ve,at as Hs,p as nt,b as es,c as ts,i as gt,I as ss,r as vt,j as rs,e as at,k as me,$ as Je}from"../chunks/runtime.BLVj8dz7.js";import{b as wt,i as ns}from"../chunks/this.Dx7VmjCJ.js";import{i as Ys}from"../chunks/lifecycle.BIiKv-Jy.js";import{a as U,p as Ce,n as as,s as is,f as ut,c as pe}from"../chunks/props.BmCjkDKm.js";import{s as os}from"../chunks/snippet.Dba1K6CO.js";import{b as Bs,s as ls}from"../chunks/attributes.DpYvJWZY.js";import{a as Xt,o as Et}from"../chunks/index-client.CWFbZt41.js";import{w as $e,g as dt}from"../chunks/index.Bnwk7SW7.js";import{s as bt,l as Ke,c as Gs}from"../chunks/global.Dt1GEbnv.js";function ht(e,t,s,r){var n=e.__styles??(e.__styles={});n[t]!==s&&(n[t]=s,s==null?e.style.removeProperty(t):e.style.setProperty(t,s,""))}var ie,be,Le,Qe,cs;const et=class et{constructor(t){E(this,Qe);E(this,ie,new WeakMap);E(this,be);E(this,Le);$(this,Le,t)}observe(t,s){var r=f(this,ie).get(t)||new Set;return r.add(s),f(this,ie).set(t,r),Y(this,Qe,cs).call(this).observe(t,f(this,Le)),()=>{var n=f(this,ie).get(t);n.delete(s),n.size===0&&(f(this,ie).delete(t),f(this,be).unobserve(t))}}};ie=new WeakMap,be=new WeakMap,Le=new WeakMap,Qe=new WeakSet,cs=function(){return f(this,be)??$(this,be,new ResizeObserver(t=>{for(var s of t){et.entries.set(s.target,s);for(var r of f(this,ie).get(s.target)||[])r(s)}}))},Yt(et,"entries",new WeakMap);let xt=et;var Xs=new xt({box:"border-box"});function Ut(e,t,s){var r=Xs.observe(e,()=>s(e[t]));zs(()=>(Qt(()=>s(e[t])),r))}function Us(e,t,s,r,n){var l=()=>{r(s[e])};s.addEventListener(t,l),l(),(s===document.body||s===window||s===document)&&Ws(()=>{s.removeEventListener(t,l)})}function Me(e){x(e,e.v+1)}const Js=e=>{const t=e*2,s=t>>16&255,r=t>>8&255,n=t&255;return[s,r,n]},Ks=([e,t,s])=>{const r=(e<<16|t<<8|s)/2;return r%1?0:r},Vs=["filter","shadowBlur","globalCompositeOperation","globalAlpha","fillStyle","strokeStyle"],qs=(e,t,{rgbToId:s=Ks,idToRgb:r=Js}={})=>{const n=e.getContext("2d",t),l=new OffscreenCanvas(e.width,e.height),d=l.getContext("2d",{willReadFrequently:!0,alpha:(t==null?void 0:t.alpha)??!0});let o=e.width,h=e.height;return new Proxy(n,{get(w,p){if((e.width!==o||e.height!==h)&&(o=l.width=e.width,h=l.height=e.height),p==="getLayerIdAt")return(y,v)=>{const[S,L,D]=d.getImageData(y,v,1,1).data;return s([S,L,D])};if(p==="setCurrentLayerId")return y=>{const[v,S,L]=r(y),D=`rgb(${v},${S},${L})`;d.fillStyle=D,d.strokeStyle=D};const m=w[p];return typeof m!="function"?m:(...y)=>{let v=p,S=y;return p==="drawImage"&&(v="fillRect",S=y.slice(-4)),d[v](...S),Reflect.apply(m,w,y)}},set(w,p,m){return w[p]=m,Vs.includes(p)||(d[p]=m),!0}})};var Q,ee,se,xe,Ve;const Mt=class Mt extends Map{constructor(s){super();E(this,xe);E(this,Q,new Map);E(this,ee,ye(0));E(this,se,ye(0));if(s){for(var[r,n]of s)super.set(r,n);f(this,se).v=super.size}}has(s){var r=f(this,Q),n=r.get(s);if(n===void 0){var l=super.get(s);if(l!==void 0)n=ye(0),r.set(s,n);else return i(f(this,ee)),!1}return i(n),!0}forEach(s,r){Y(this,xe,Ve).call(this),super.forEach(s,r)}get(s){var r=f(this,Q),n=r.get(s);if(n===void 0){var l=super.get(s);if(l!==void 0)n=ye(0),r.set(s,n);else{i(f(this,ee));return}}return i(n),super.get(s)}set(s,r){var m;var n=f(this,Q),l=n.get(s),d=super.get(s),o=super.set(s,r),h=f(this,ee);if(l===void 0)n.set(s,ye(0)),x(f(this,se),super.size),Me(h);else if(d!==r){Me(l);var w=h.reactions===null?null:new Set(h.reactions),p=w===null||!((m=l.reactions)!=null&&m.every(y=>w.has(y)));p&&Me(h)}return o}delete(s){var r=f(this,Q),n=r.get(s),l=super.delete(s);return n!==void 0&&(r.delete(s),x(f(this,se),super.size),x(n,-1),Me(f(this,ee))),l}clear(){if(super.size!==0){super.clear();var s=f(this,Q);x(f(this,se),0);for(var r of s.values())x(r,-1);Me(f(this,ee)),s.clear()}}keys(){return i(f(this,ee)),super.keys()}values(){return Y(this,xe,Ve).call(this),super.values()}entries(){return Y(this,xe,Ve).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return i(f(this,se)),super.size}};Q=new WeakMap,ee=new WeakMap,se=new WeakMap,xe=new WeakSet,Ve=function(){i(f(this,ee));var s=f(this,Q);if(f(this,se).v!==s.size)for(var r of Gt(Mt.prototype,this,"keys").call(this))s.has(r)||s.set(r,ye(0));for(var[,n]of f(this,Q))i(n)};let _e=Mt;const Zs=e=>{if(window.TouchEvent&&e instanceof TouchEvent){const{left:r,top:n}=e.target.getBoundingClientRect(),{clientX:l,clientY:d}=e.changedTouches[0];return{x:l-r,y:d-n}}const{offsetX:t,offsetY:s}=e;return{x:t,y:s}},Jt=(e,t)=>{var s,r;e instanceof MouseEvent&&((s=e.target)==null||s.dispatchEvent(new PointerEvent(`layer.pointer${t}`,e)),(r=e.target)==null||r.dispatchEvent(new MouseEvent(`layer.mouse${t}`,e)))},$s=["onclick","oncontextmenu","ondblclick","onauxclick","onmousedown","onmouseenter","onmouseleave","onmouseup","onmousemove","onwheel","ontouchstart","ontouchcancel","ontouchend","ontouchmove","onpointerenter","onpointerleave","onpointerdown","onpointerup","onpointermove","onpointercancel","onlayer.mouseenter","onlayer.mouseleave","onlayer.pointerenter","onlayer.pointerleave","onfocus","onblur","onfullscreenchange","onfullscreenerror","onscroll","oncut","oncopy","onpaste","onkeydown","onkeypress","onkeyup","onmouseover","onmouseout","onselect","ondrag","ondragend","ondragenter","ondragstart","ondragleave","ondragover","ondrop","onpointerover","onpointerout","ongotpointercapture","onlostpointercapture"],Qs=e=>console.warn("[svelte-canvas] %s",e),fs=Symbol("register"),er=e=>Fs(fs)(e);var Se,Ie,ke,tt,st,ze,ue,V,Pe,Ee,We,Fe,Ae,_,us,ds,hs,ys,St,ms,ps,gs;class tr{constructor(t){E(this,_);E(this,Se,new _e);E(this,Ie,new _e);E(this,ke,new _e);E(this,tt,1);E(this,st,Date.now());E(this,ze,F(0));E(this,ue);E(this,V);E(this,Pe);E(this,Ee);E(this,We,F(U([])));E(this,Fe,0);E(this,Ae);$(this,V,t),Ds(fs,this.register.bind(this))}init(t,s){$(this,ue,t),Y(this,_,ys).call(this,s),ve(()=>Y(this,_,St).call(this)),ve(()=>Y(this,_,hs).call(this)),ve(()=>(i(f(this,ze)),Y(this,_,ms).call(this))),Xt(()=>Y(this,_,gs).call(this))}redraw(){Hs(f(this,ze))}register({setup:t,render:s,...r}){const n=Y(this,_,us).call(this);return t&&f(this,Se).set(n,t),f(this,Ie).set(n,s),Object.keys(r).length&&(f(this,V).layerEvents?f(this,ke).set(n,r):Qs("Canvas must have layerEvents={true} in order to use layer-level event handlers")),Xt(()=>Y(this,_,ds).call(this,n)),n}createEventHandlers(){const t=n=>{const l=`on${n.type}`,d=f(this,V).handlers[l];d==null||d(n)},s=n=>{const{pixelRatio:l}=f(this,V),{x:d,y:o}=Zs(n);if(["touchstart","pointermove"].includes(n.type)){const p=f(this,ue).getLayerIdAt(d*l,o*l);Y(this,_,ps).call(this,p,n)}if(!f(this,Ae))return;const h=`on${n.type.replace("layer.","")}`,w=f(this,Ae)[h];w==null||w({x:d,y:o,originalEvent:n})},r=n=>{t(n),f(this,V).layerEvents&&s(n)};return $s.reduce((n,l)=>({...n,[l]:r}),{})}}Se=new WeakMap,Ie=new WeakMap,ke=new WeakMap,tt=new WeakMap,st=new WeakMap,ze=new WeakMap,ue=new WeakMap,V=new WeakMap,Pe=new WeakMap,Ee=new WeakMap,We=new WeakMap,Fe=new WeakMap,Ae=new WeakMap,_=new WeakSet,us=function(){return Bt(this,tt)._++},ds=function(t){f(this,Ie).delete(t),f(this,ke).delete(t)},hs=function(){const{onresize:t,width:s,height:r,pixelRatio:n}=f(this,V);t==null||t({width:s,height:r,pixelRatio:n})},ys=function(t){const s=()=>{const r=[...t.children];x(f(this,We),U(r.map(n=>+n.dataset.layerId)))};$(this,Ee,new MutationObserver(()=>s())),f(this,Ee).observe(t,{childList:!0}),s()},St=function(){f(this,V).autoplay?(Qt(()=>this.redraw()),$(this,Pe,requestAnimationFrame(()=>Y(this,_,St).call(this)))):cancelAnimationFrame(f(this,Pe))},ms=function(){var h,w,p;const t=f(this,ue),{width:s,height:r,pixelRatio:n,autoclear:l}=f(this,V),d=Date.now()-f(this,st),o={context:t,width:s,height:r,time:d};t.setTransform(n,0,0,n,0,0),l&&t.clearRect(0,0,s,r);for(const[m,y]of f(this,Se))y(o),f(this,Se).delete(m);for(const m of i(f(this,We)))(w=(h=f(this,ue)).setCurrentLayerId)==null||w.call(h,m),(p=f(this,Ie).get(m))==null||p(o)},ps=function(t,s){f(this,Fe)!==t&&(Jt(s,"leave"),$(this,Fe,t),$(this,Ae,f(this,ke).get(t)),Jt(s,"enter"))},gs=function(){var t;typeof window>"u"||((t=f(this,Ee))==null||t.disconnect(),cancelAnimationFrame(f(this,Pe)))};/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function sr(e,t){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var r,n,l,d,o=[],h=!0,w=!1;try{if(l=(s=s.call(e)).next,t===0){if(Object(s)!==s)return;h=!1}else for(;!(h=(r=l.call(s)).done)&&(o.push(r.value),o.length!==t);h=!0);}catch(p){w=!0,n=p}finally{try{if(!h&&s.return!=null&&(d=s.return(),Object(d)!==d))return}finally{if(w)throw n}}return o}}function Kt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),s.push.apply(s,r)}return s}function X(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Kt(Object(s),!0).forEach(function(r){rr(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Kt(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function rr(e,t,s){return t=dr(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function nr(e,t){if(e==null)return{};var s={},r=Object.keys(e),n,l;for(l=0;l<r.length;l++)n=r[l],!(t.indexOf(n)>=0)&&(s[n]=e[n]);return s}function ar(e,t){if(e==null)return{};var s=nr(e,t),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function Vt(e,t){return or(e)||sr(e,t)||vs(e,t)||fr()}function Be(e){return ir(e)||lr(e)||vs(e)||cr()}function ir(e){if(Array.isArray(e))return It(e)}function or(e){if(Array.isArray(e))return e}function lr(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function vs(e,t){if(e){if(typeof e=="string")return It(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return It(e,t)}}function It(e,t){(t==null||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}function cr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ur(e,t){if(typeof e!="object"||e===null)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var r=s.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dr(e){var t=ur(e,"string");return typeof t=="symbol"?t:String(t)}function Re(e){var t=e.sizes.shift(),s=Math.max(Math.ceil(t[0]),1),r=Math.max(Math.ceil(t[1]),1),n=[s-1,r-1,1,1],l=Date.now(),d=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,o,h;d?(o=new OffscreenCanvas(1,1),h=new OffscreenCanvas(s,r)):(o=document.createElement("canvas"),o.width=1,o.height=1,h=document.createElement("canvas"),h.width=s,h.height=r);var w=o.getContext("2d"),p=h.getContext("2d");p&&(p.fillRect.apply(p,n),w.drawImage(h,s-1,r-1,1,1,0,0,1,1));var m=w&&w.getImageData(0,0,1,1).data[3]!==0,y=Date.now()-l;return[o,h].forEach(function(v){v.height=0,v.width=0}),d?(postMessage({width:s,height:r,benchmark:y,isTestPass:m}),!m&&e.sizes.length&&Re(e)):m?e.onSuccess(s,r,y):(e.onError(s,r,y),e.sizes.length&&Re(e)),m}var yt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},hr=["onError","onSuccess"],ge={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Te={};function mt(e){var t=e.width===e.height,s=e.height===1,r=e.width===1,n=[];if(!e.width||!e.height)e.sizes.forEach(function(p){var m=t||s?p:1,y=t||r?p:1;n.push([m,y])});else for(var l=e.min||ge.min,d=e.step||ge.step,o=Math.max(e.width,e.height);o>=l;){var h=t||s?o:1,w=t||r?o:1;n.push([h,w]),o-=d}return n}function Ge(e){var t=window&&"HTMLCanvasElement"in window,s=window&&"OffscreenCanvas"in window,r=Date.now(),n=e.onError,l=e.onSuccess,d=ar(e,hr),o=null;if(!t)return!1;if(e.useWorker&&s){var h=`
            var canvasTest = `.concat(Re.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),w=new Blob([h],{type:"application/javascript"}),p=URL.createObjectURL(w);o=new Worker(p),URL.revokeObjectURL(p),o.onmessage=function(m){var y=m.data,v=y.width,S=y.height,L=y.benchmark,D=y.isTestPass;D?(Te[r].onSuccess(v,S,L),delete Te[r]):Te[r].onError(v,S,L)}}if(e.usePromise)return new Promise(function(m,y){var v=X(X({},e),{},{onError:function(q,z,W){var b;if(e.sizes.length===0)b=!0;else{var de=e.sizes.slice(-1),C=Vt(de,1),re=Vt(C[0],2),N=re[0],J=re[1];b=q===N&&z===J}n(q,z,W),b&&y({width:q,height:z,benchmark:W})},onSuccess:function(q,z,W){l(q,z,W),m({width:q,height:z,benchmark:W})}});if(o){var S=v.onError,L=v.onSuccess;Te[r]={onError:S,onSuccess:L},o.postMessage(d)}else Re(v)});if(o)Te[r]={onError:n,onSuccess:l},o.postMessage(d);else return Re(e)}var yr={maxArea:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=mt({width:t.max,height:t.max,min:t.min,step:t.step,sizes:Be(yt.area)}),r=X(X(X({},ge),t),{},{sizes:s});return Ge(r)},maxHeight:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=mt({width:1,height:t.max,min:t.min,step:t.step,sizes:Be(yt.height)}),r=X(X(X({},ge),t),{},{sizes:s});return Ge(r)},maxWidth:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=mt({width:t.max,height:1,min:t.min,step:t.step,sizes:Be(yt.width)}),r=X(X(X({},ge),t),{},{sizes:s});return Ge(r)},test:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=X(X({},ge),t);return s.sizes=Be(s.sizes),s.width&&s.height&&(s.sizes=[[s.width,s.height]]),Ge(s)}};const mr=(e,t,s,r=.1)=>{if(typeof window>"u")return s;for(;!yr.test({sizes:[[e*s,t*s]]});)s-=r;return s};var pr=rt("<canvas></canvas> <div><!></div>",1);function gr(e,t){nt(t,!0);let s=Ce(t,"style",3,""),r=Ce(t,"autoplay",3,!1),n=Ce(t,"autoclear",3,!0),l=Ce(t,"layerEvents",3,!1),d=as(t,["$$slots","$$events","$$legacy","width","height","pixelRatio","class","style","autoplay","autoclear","layerEvents","onresize","contextSettings","children"]),o,h,w,p=F(2),m=F(0),y=F(0);const v=me(()=>t.width??i(m)),S=me(()=>t.height??i(y)),L=me(()=>i(p)&&t.pixelRatio==="auto"?mr(i(v),i(S),i(p)):t.pixelRatio&&t.pixelRatio!=="auto"?t.pixelRatio:i(p)),D=new tr({get width(){return i(v)},get height(){return i(S)},get pixelRatio(){return i(L)},get autoplay(){return r()},get autoclear(){return n()},get layerEvents(){return l()},get onresize(){return t.onresize},handlers:d});Et(()=>{l()?h=qs(o,t.contextSettings):h=o.getContext("2d",t.contextSettings),D.init(h,w)});const q=()=>D.redraw();var z=pr(),W=es(z);const b=me(()=>D.createEventHandlers());let de;wt(W,N=>o=N,()=>o);var C=ts(W,2);ht(C,"display","none");var re=gt(C);return os(re,()=>t.children??ss),vt(C),wt(C,N=>w=N,()=>w),rs(()=>{de=Bs(W,de,{class:t.class,width:i(v)*i(L),height:i(S)*i(L),style:s(),...i(b)}),ht(W,"width",t.width?`${t.width}px`:"100%"),ht(W,"height",t.height?`${t.height}px`:"100%")}),Us("devicePixelRatio","resize",Je,N=>x(p,U(N))),Ut(W,"clientWidth",N=>x(m,N)),Ut(W,"clientHeight",N=>x(y,N)),je(e,z),at({redraw:q,get canvas(){return o},set canvas(N){o=N},get context(){return h},set context(N){h=N}})}var vr=rt("<div></div>");function wr(e,t){nt(t,!0);const s=as(t,["$$slots","$$events","$$legacy"]),r=er(s);var n=vr();ls(n,"data-layer-id",r),je(e,n),at()}const At=$e(void 0),Ot=$e(void 0);let O;const we={},ce={},ae={},ws=new Set,qe={},kt={},Ne={},bs={},A={};let Xe=.3835;const qt={Juggernaut:{x:-10400,y:5200},Berserker:{x:-10400,y:3700},Chieftain:{x:-10400,y:2200},Raider:{x:10200,y:5200},Deadeye:{x:10200,y:2200},Pathfinder:{x:10200,y:3700},Occultist:{x:-1500,y:-9850},Elementalist:{x:0,y:-9850},Necromancer:{x:1500,y:-9850},Slayer:{x:1500,y:9800},Gladiator:{x:-1500,y:9800},Champion:{x:0,y:9800},Inquisitor:{x:-10400,y:-2200},Hierophant:{x:-10400,y:-3700},Guardian:{x:-10400,y:-5200},Assassin:{x:10200,y:-5200},Trickster:{x:10200,y:-3700},Saboteur:{x:10200,y:-2200},Ascendant:{x:-7800,y:7200}},fe={},br=async e=>{var s,r,n,l;if(!bt)return;const t=await bt.GetTree(e);O=JSON.parse(t),console.log("Loaded skill tree",O),O.imageZoomLevels&&(Xe=O.imageZoomLevels[O.imageZoomLevels.length-1]),Object.keys(O.groups).forEach(d=>{var w;const o=O.groups[d],h=parseInt(d);we[h]=o,(w=o.nodes)==null||w.forEach(p=>{const m=O.nodes[p];if(ce[parseInt(p)]=m,m.classStartIndex!==void 0){qe[h]=m.classStartIndex;for(const y of[...m.out||[],...m.in||[]]){const v=O.nodes[y];v.skill&&v.ascendancyName===void 0&&(kt[m.classStartIndex]=[...kt[m.classStartIndex]||[],v.skill])}}m.ascendancyName!==void 0&&(ae[h]=m.ascendancyName),m.isAscendancyStart&&(ws.add(h),m.ascendancyName&&(fe[m.ascendancyName]={x:qt[m.ascendancyName].x-o.x,y:qt[m.ascendancyName].y-o.y}))})});for(const d of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const o=(s=O.sprites[d])==null?void 0:s[Xe];Object.keys((o==null?void 0:o.coords)||{}).forEach(h=>o&&(Ne[h]=o))}for(const d of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const o=(r=O.sprites[d])==null?void 0:r[Xe];Object.keys(o.coords).forEach(h=>o&&(bs[h]=o))}for(const d of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let o=(n=O.sprites[d])==null?void 0:n[Xe];o||(o=(l=O.sprites[d])==null?void 0:l[Object.keys(O.sprites[d])[0]]),Object.keys((o==null?void 0:o.coords)||{}).forEach(h=>o&&(A[h]=o))}At.set(O),Ot.set(e)},Ze=(e,t,s,r,n)=>({x:(Math.abs(O.min_x)+e+s)/n,y:(Math.abs(O.min_y)+t+r)/n}),xr=(e,t,s)=>{const r=Math.PI/180*s,n=Math.cos(r),l=Math.sin(r),d=n*(t.x-e.x)+l*(t.y-e.y)+e.x,o=n*(t.y-e.y)-l*(t.x-e.x)+e.y;return{x:d,y:o}},Zt=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],$t=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],Pt=(e,t)=>{var r;const s=(r=O.constants.skillsPerOrbit)==null?void 0:r[e];return s==16?Zt[Zt.length-t]||0:s==40?$t[$t.length-t]||0:360-360/(s||1)*t},Ue={},pt=(e,t,s,r)=>{var n,l;if(e.group===void 0||e.orbit===void 0||e.orbitIndex===void 0||e.skill===void 0||!O.groups||!O.constants.orbitRadii)return{x:0,y:0};if(!(e.skill in Ue)){const d=O.groups[e.group],o=(e.ascendancyName&&((n=fe[e.ascendancyName])==null?void 0:n.x)||0)+d.x,h=(e.ascendancyName&&((l=fe[e.ascendancyName])==null?void 0:l.y)||0)+d.y,w=Pt(e.orbit,e.orbitIndex);Ue[e.skill]=xr({x:o,y:h},{x:o,y:h-O.constants.orbitRadii[e.orbit]},w)}return Ze(Ue[e.skill].x,Ue[e.skill].y,t,s,r)},Sr=(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));var Ir=rt("<div><!> <!></div>"),kr=rt('<div class="w-full h-full max-w-full max-h-full overflow-hidden"><!></div>');function Pr(e,t){nt(t,!0);const s=is(),r=()=>pe(Gs,"$currentBuild",s),n=()=>pe(Ot,"$skillTreeVersion",s),l=()=>pe(At,"$skillTree",s),d=()=>pe(N,"$hoverPath",s);let o=F(void 0);ve(()=>{var a;(a=r())==null||a.Build.ClassName.then(M=>x(o,U(M))).catch(Ke)});let h=F(void 0);ve(()=>{var a;(a=r())==null||a.Build.AscendClassName.then(M=>x(h,U(M))).catch(Ke)});let w=Ce(t,"clickNode",19,()=>console.log);const p="25px Roboto Flex",m="17px Roboto Flex";let y=F(10),v=F(0),S=F(0);const L=2.6;let D=me(()=>`https://go-pob-data.pages.dev/data/${(n()||"3_18").replace("_",".")}`),q=me(()=>i(D)+"/tree/assets/");const z={},W={},b=(a,M,Z,te,H=!1,B=!1,ne=!1)=>{const Oe=te[M];if(!Oe)return;const I=Oe.filename;if(!(I in z)){const j=new URL(I).pathname,T=j.substring(j.lastIndexOf("/")+1),G=i(q)+T;z[I]=new Image,z[I].src=G}const c=Oe.coords[M],u=c.w/i(y)*L,g=c.h/i(y)*L,k=Z.x-u/2,P=Z.y-g/2;let R=P;if(H&&(R=P-g/2),B&&z[I].complete){const j=I+":"+M+";"+(ne?"active":"");if(!(j in W)){const T=document.createElement("canvas"),G=T.getContext("2d");T.width=c.w,T.height=c.h,G.save(),G.beginPath(),G.arc(c.w/2,c.h/2,c.w/2,0,Math.PI*2,!0),G.closePath(),G.clip(),ne||(G.filter="brightness(50%) opacity(50%)"),G.drawImage(z[I],c.x,c.y,c.w,c.h,0,0,c.w,c.h),W[j]=T}a.drawImage(W[j],0,0,c.w,c.h,k,R,u,g)}else a.drawImage(z[I],c.x,c.y,c.w,c.h,k,R,u,g);H&&(a.save(),a.translate(k,P),a.rotate(Math.PI),a.drawImage(z[I],c.x,c.y,c.w,c.h,-u,-(g/2),u,-g),a.restore())},de=(a,M,Z)=>{const te=[];let H="";return a.split(" ").forEach(B=>{M.measureText(H+B).width<Z?H+=" "+B:(te.push(H.trim()),H=B)}),H.length>0&&te.push(H.trim()),te};let C=F(U({x:Number.MIN_VALUE,y:Number.MIN_VALUE})),re=F("unset");const N=$e([]),J=U({}),De=$e(),xs=({context:a,width:M,height:Z})=>{const te=window.performance.now();if(!l())return;if(a.clearRect(0,0,M,Z),a.fillStyle="#080c11",a.fillRect(0,0,M,Z),i(o)){const I=l().classes.findIndex(c=>c.name===i(o));if(I in l().extraImages){const c=l().extraImages[I];if(c.image in J||(J[c.image]=new Image,J[c.image].src=i(D)+"/raw/"+c.image),J[c.image].complete){const u=J[c.image].width/i(y)*L*.5,g=J[c.image].height/i(y)*L*.5,k=Ze(c.x,c.y,i(v),i(S),i(y));a.drawImage(J[c.image],0,0,J[c.image].width,J[c.image].height,k.x,k.y,u,g)}}}const H={};Object.keys(we).forEach(I=>{var j,T;const c=parseInt(I),u=we[c],g=(c in ae&&((j=fe[ae[c]])==null?void 0:j.x)||0)+u.x,k=(c in ae&&((T=fe[ae[c]])==null?void 0:T.y)||0)+u.y,P=Ze(g,k,i(v),i(S),i(y)),R=Math.max(...u.orbits);c in qe?i(o)===l().classes[qe[c]].name?b(a,"center"+l().classes[qe[c]].name.toLowerCase(),P,A):b(a,"PSStartNodeBackgroundInactive",P,A,!1,!0):c in ae?ws.has(c)&&b(a,"Classes"+ae[c],P,A,!1,!0,i(h)===ae[c]):R==1?b(a,"PSGroupBackground1",P,A):R==2?b(a,"PSGroupBackground2",P,A):(R==3||u.orbits.length>1)&&b(a,"PSGroupBackground3",P,A,!0)}),Object.keys(ce).forEach(I=>{var R;const c=parseInt(I),u=ce[c],g=Pt(u.orbit,u.orbitIndex),k=pt(u,i(v),i(S),i(y));if(u.classStartIndex!==void 0)return;const P=d().indexOf(u.skill)>=0;(R=u.out)==null||R.forEach(j=>{var Lt,zt;if(!ce[parseInt(j)])return;const T=Math.min(parseInt(j),parseInt(I)),G=Math.max(parseInt(j),parseInt(I)),ct=T+":"+G;if(ct in H)return;H[ct]=!0;const K=ce[parseInt(j)];if(K.isMastery||u.ascendancyName!==K.ascendancyName||K.classStartIndex!==void 0)return;const As=Pt(K.orbit,K.orbitIndex),jt=pt(K,i(v),i(S),i(y));if(a.beginPath(),u.group!=K.group||u.orbit!=K.orbit)a.moveTo(k.x,k.y),a.lineTo(jt.x,jt.y);else{let oe=Math.PI/180-Math.PI/180*g,le=Math.PI/180-Math.PI/180*As;oe-=Math.PI/2,le-=Math.PI/2;const Wt=Math.abs(Math.max(oe,le)-Math.min(oe,le)),Os=Wt>Math.PI?Math.max(oe,le):Math.min(oe,le),Ms=Wt>Math.PI?Math.min(oe,le):Math.max(oe,le),Ft=we[u.group],Ts=(u.ascendancyName&&((Lt=fe[u.ascendancyName])==null?void 0:Lt.x)||0)+Ft.x,Cs=(u.ascendancyName&&((zt=fe[u.ascendancyName])==null?void 0:zt.y)||0)+Ft.y,Dt=Ze(Ts,Cs,i(v),i(S),i(y));a.arc(Dt.x,Dt.y,l().constants.orbitRadii[u.orbit]/i(y)+1,Os,Ms)}P&&d().indexOf(K.skill)>=0?a.strokeStyle="#c89c01":a.strokeStyle="#524518",a.lineWidth=6/i(y),a.stroke()})});let B;if(Object.keys(ce).forEach(I=>{const c=parseInt(I),u=ce[c],g=pt(u,i(v),i(S),i(y));let k=0;u.classStartIndex!==void 0||u.isAscendancyStart||(u.isKeystone?k=110:u.isNotable||u.isJewelSocket?k=70:u.isMastery?k=85:k=50),Sr(g,i(C))<k/i(y)&&(B=u);const P=d().indexOf(u.skill)>=0||B===u;u.classStartIndex!==void 0||(u.isAscendancyStart?b(a,"AscendancyMiddle",g,A):u.isKeystone?(b(a,u.icon,g,Ne),P?b(a,"KeystoneFrameAllocated",g,A):b(a,"KeystoneFrameUnallocated",g,A)):u.isNotable?(b(a,u.icon,g,Ne),u.ascendancyName?P?b(a,"AscendancyFrameLargeAllocated",g,A):b(a,"AscendancyFrameLargeNormal",g,A):P?b(a,"NotableFrameAllocated",g,A):b(a,"NotableFrameUnallocated",g,A)):u.isJewelSocket?u.expansionJewel?P?b(a,"JewelSocketAltActive",g,A):b(a,"JewelSocketAltNormal",g,A):P?b(a,"JewelFrameAllocated",g,A):b(a,"JewelFrameUnallocated",g,A):u.isMastery?P?b(a,u.activeIcon,g,bs):b(a,u.inactiveIcon,g,Ne):(b(a,u.icon,g,Ne),u.ascendancyName?P?b(a,"AscendancyFrameSmallAllocated",g,A):b(a,"AscendancyFrameSmallNormal",g,A):P?b(a,"PSSkillFrameActive",g,A):b(a,"PSSkillFrame",g,A)))}),dt(De)!=B)if(De.set(B),B!==void 0&&i(o)){const I=kt[l().classes.findIndex(u=>u.name===i(o))],c=B.skill;bt.CalculateTreePath(n()||"3_18",I,c).then(u=>{u&&N.set(u)}).catch(Ke)}else N.set([]);const ne=dt(De);if(ne){const I=ne.name||"N/A",c=(ne.stats||[]).map(T=>({text:T,special:!1}));a.font=p;const u=a.measureText(I),g=Math.max(u.width+50,600);a.font=m;const k=[],P=30;let R=85;c&&c.length>0?c.forEach(T=>{k.length>0&&(R+=5),T.text.split(`
`).forEach(G=>{k.length>0&&(R+=10),de(G,a,g-P).forEach(K=>{k.push({text:K,offset:R,special:T.special}),R+=20})})}):ne.isJewelSocket&&(k.push({text:"Click to select this socket",offset:R,special:!0}),R+=20);const j=55;a.fillStyle="rgba(75,63,24,0.9)",a.fillRect(i(C).x,i(C).y,g,j),a.fillStyle="#ffffff",a.font=p,a.textAlign="center",a.fillText(I,i(C).x+g/2,i(C).y+35),a.fillStyle="rgba(0,0,0,0.8)",a.fillRect(i(C).x,i(C).y+j,g,R-j),a.font=m,a.textAlign="left",k.forEach(T=>{T.special?a.fillStyle="#8cf34c":a.fillStyle="#ffffff",a.fillText(T.text,i(C).x+P/2,i(C).y+T.offset)})}ne?x(re,"pointer"):x(re,"unset"),a.fillStyle="#ffffff",a.textAlign="right",a.font="12px Roboto Mono";const Oe=window.performance.now();a.fillText(`${(Oe-te).toFixed(1)}ms`,M-5,17)};let Tt=0,Ct=0,Nt=0,_t=0,it=!1;const Ss=a=>{it=!0,Tt=a.offsetX,Ct=a.offsetY,Nt=i(v),_t=i(S),x(C,U({x:a.offsetX,y:a.offsetY}));const M=dt(De);M&&w()(M)},Is=a=>{a.type==="pointerup"&&(it=!1),x(C,U({x:a.offsetX,y:a.offsetY}))},ks=a=>{it&&(x(v,Nt-(Tt-a.offsetX)*i(y)),x(S,_t-(Ct-a.offsetY)*i(y))),x(C,U({x:a.offsetX,y:a.offsetY}))},Ps=a=>{a.deltaY>0?i(y)<30&&(x(v,i(v)+a.offsetX),x(S,i(S)+a.offsetY)):i(y)>3&&(x(v,i(v)-a.offsetX),x(S,i(S)-a.offsetY)),x(y,U(Math.min(30,Math.max(3,i(y)+a.deltaY/100)))),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()};let he=F(void 0),ot=F(0),lt=F(0);const He=()=>{i(he)&&(x(ot,U(i(he).offsetWidth)),x(lt,U(i(he).offsetHeight)))};let Rt=F(!1);ve(()=>{!i(Rt)&&l()&&(x(Rt,!0),x(v,l().min_x+window.innerWidth/2*i(y)),x(S,l().min_y+window.innerHeight/2*i(y))),He()}),Et(()=>{new ResizeObserver(He).observe(i(he)),He()});var Ye=kr();ut("pointerup",Je,Is),ut("pointermove",Je,ks),ut("resize",Je,He);var Es=gt(Ye);ns(Es,()=>i(ot)&&i(lt),a=>{var M=Ir(),Z=gt(M);gr(Z,{get width(){return i(ot)},get height(){return i(lt)},onpointerdown:Ss,onwheel:Ps,children:(H,B)=>{wr(H,{render:xs})},$$slots:{default:!0}});var te=ts(Z,2);os(te,()=>t.children??ss),vt(M),rs(()=>ls(M,"style",`touch-action: none; cursor: ${i(re)??""}`)),je(a,M)}),vt(Ye),wt(Ye,a=>x(he,a),()=>i(he)),je(e,Ye),at()}function Wr(e,t){nt(t,!1);const s=is(),r=()=>pe(At,"$skillTree",s),n=()=>pe(Ot,"$skillTreeVersion",s);Et(()=>{(!r()||!n()||Object.keys(we).length===0)&&br("3_18").catch(Ke)}),Ys();var l=Ls(),d=es(l);ns(d,()=>r()&&n()&&Object.keys(we).length>0,o=>{Pr(o,{})}),je(e,l),at()}export{Wr as component};
